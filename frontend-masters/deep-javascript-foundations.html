<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Deep JavaScript Foundations, v3 | Wizard Unicorn Ninja</title>



<meta name="description" content="These are notes from the 'Deep JavaScript Foundations, v3' course on Frontend Masters.">



<link rel="shortcut icon" type="image/ico"
  href="">

<link rel="icon" type="image/png"
  href="/assets/uswds/img/favicons/favicon.png">

<link rel="icon" type="image/png"
  sizes="192x192"
  href="/assets/uswds/img/favicons/favicon-192.png">

<link rel="apple-touch-icon-precomposed" type=""
  href="/assets/uswds/img/favicons/favicon-57.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="72x72"
  href="/assets/uswds/img/favicons/favicon-72.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="114x114"
  href="/assets/uswds/img/favicons/favicon-114.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="144x144"
  href="/assets/uswds/img/favicons/favicon-144.png">



    



<link rel="stylesheet"
  href="/assets/css/main.css"
  media="screen">


    
  </head>
  <body class="  ">

    <a class="usa-skipnav" href="#main-content">Skip to main content</a>

    


  <section class="usa-banner">
  <div class="usa-accordion">
    <!-- <header class="usa-banner-header">
      <div class="usa-grid usa-banner-inner"> <img src="/assets/uswds/img/favicons/favicon-57.png" alt="U.S. flag">
        <p>An official website of the United States government</p> <button class="usa-accordion-button usa-banner-button" aria-expanded="false" aria-controls="gov-banner"> <span class="usa-banner-button-text">Here's how you know</span> </button> </div>
    </header> -->
    <div class="usa-banner-content usa-grid usa-accordion-content" id="gov-banner">
      <div class="usa-banner-guidance-gov usa-width-one-half"> <img class="usa-banner-icon usa-media_block-img" src="/assets/uswds/img/icon-dot-gov.svg" alt="Dot gov">
        <div class="usa-media_block-body">
          <p> <strong>The .gov means it’s official.</strong> <br> Federal government websites often end in .gov or .mil. Before sharing sensitive information, make sure you’re on a federal government site. </p>
        </div>
      </div>
      <div class="usa-banner-guidance-ssl usa-width-one-half"> <img class="usa-banner-icon usa-media_block-img" src="/assets/uswds/img/icon-https.svg" alt="Https">
        <div class="usa-media_block-body">
          <p> <strong>The site is secure.</strong> <br> The <strong>https://</strong> ensures that you are connecting to the official website and that any information you provide is encrypted and transmitted securely. </p>
        </div>
      </div>
    </div>
  </div>
</section>






  <header class="usa-header usa-header-extended" role="banner" id="usa-header">


  
    <div class="usa-navbar">
      <button class="usa-menu-btn">Menu</button>
      <div class="usa-logo" id="extended-mega-logo">
        <a href="/" title="Home">
          
            <img class="usa-logo-img" src="/assets/img/hztl-wm.svg" alt="HZTL-WM">
          
          <em class="usa-logo-text">
            Wizard Unicorn Ninja
          </em>
        </a>
      </div>
    </div>

    <nav role="navigation" class="usa-nav">
      <div class="usa-nav-inner">
        <button class="usa-nav-close">
          <img src="/assets/uswds/img/close.svg" alt="close">
        </button>

        
        
        
        <ul class="usa-nav-primary usa-accordion">
          
          <li>
            
              <a class=" usa-nav-link  " href="/resources/">
                <span>Resources</span>
              </a>
            
          </li>
          
          <li>
            
              
              
              
            <button class="usa-accordion-button usa-nav-link" aria-expanded="false" aria-controls="nav-2">
              <span>Frontend Masters Workshop Notes</span>
            </button>
            
            <ul id="nav-2" class="usa-nav-submenu" aria-hidden="true">
            
            
              
                
                <li>
                  <a href="/frontend-masters/fundamentals-functional-js">Javascript: From Fundamentals to Functional JS</a>
                </li>
                
              
                
                <li>
                  <a href="/frontend-masters/hard-parts-js">Javascript: The Hard Parts, v2</a>
                </li>
                
              
                
                <li>
                  <a href="/frontend-masters/deep-javascript-foundations">Deep Javascript Foundations, v3</a>
                </li>
                
              
                
                <li>
                  <a href="/frontend-masters/webpack-4-fundamentals">Webpack 4 Fundamentals</a>
                </li>
                
              
                
                <li>
                  <a href="/frontend-masters/web-performance-webpack">Web Performance with Webpack</a>
                </li>
                
              
                
                <li>
                  <a href="/frontend-masters/webpack-plugins-system">Webpack Plugins System</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li>
            
              
              
              
            <button class="usa-accordion-button usa-nav-link" aria-expanded="false" aria-controls="nav-3">
              <span>Sitecore Workshop Notes</span>
            </button>
            
            <ul id="nav-3" class="usa-nav-submenu" aria-hidden="true">
            
            
              
                
                <li>
                  <a href="/sitecore/jss">Sitecore JSS Fundamentals</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
        </ul>
        

        

          
          
          <div class="usa-nav-secondary">
            
            <ul class="usa-unstyled-list usa-nav-secondary-links">
              
              
              
                <li>
                  <a href=""
                  >
                    
                  </a>
                </li>
              
            </ul>
          </div>
          


        </div>
      </div>
    </nav>
  
  <div class="main-top">
      <div class="progress-container">
        <div class="progress-bar" id="progress"></div>
      </div>
    </div>
  </header>
  <div class="usa-overlay"></div>




    
    


    

    

    
      
      




    
    

    <main id="main-content" class="usa-grid usa-section usa-content usa-layout-docs">
          


<div class="usa-layout-docs-main_content">
  
    <h1>Deep JavaScript Foundations, v3</h1>
  
  <h2 id="introduction">Introduction</h2>

<h3 id="introduction-1">Introduction</h3>

<p><a href="https://static.frontendmasters.com/resources/2019-03-07-deep-javascript-v2/deep-js-foundations-v2.pdf">Link to the course document</a></p>

<p><a href="https://static.frontendmasters.com/resources/2019-03-07-deep-javascript-v2/deep-js-foundations-v2-exercises.zip">Link to the course’s code exercises</a></p>

<p>The instructor talks about the depth that this course gets into. But why dive deep into JavaScript? Consider the following code:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>

<span class="nx">x</span><span class="o">++</span><span class="p">;</span> <span class="c1">// 40 - placing the plus symbols after the variable will give you the current value of the variable and then increment</span>
<span class="nx">x</span><span class="p">;</span> <span class="c1">// 41 - this will log the current value of the variable</span>

<span class="o">++</span><span class="nx">x</span><span class="p">;</span> <span class="c1">// 42 - placing the plus symbols before the variable will increment the value and then return the result</span>
<span class="nx">x</span><span class="p">;</span> <span class="c1">// 42 - this will log the current value of the variable</span></code></pre></figure>

<p>We as developers tend to assume mental models about code and when something goes wrong instead of having a better understanding about the code. The unintuitive-ness of JavaScript does not mean that it was poorly defined. <strong>Read the spec docs!</strong></p>

<h3 id="understanding-your-code">Understanding Your Code</h3>

<p>According to the JavaScript spec for the <code class="language-plaintext highlighter-rouge">++</code> operator:</p>

<blockquote>
  <p><strong>12.4.4.1 Runtime Semantics: Evaluation
<em>UpdateExpression : LeftHandSideExpression **++</em></strong></p>

  <ol>
    <li>Let <code class="language-plaintext highlighter-rouge">lhs</code> be the result of evaluating <em>LeftHansSideExpression</em>.</li>
    <li>Let <code class="language-plaintext highlighter-rouge">oldValue</code> be ? <code class="language-plaintext highlighter-rouge">ToNumber</code>(?<code class="language-plaintext highlighter-rouge">GetValue(lhs)</code>).</li>
    <li>Let <code class="language-plaintext highlighter-rouge">newValue</code> be the result of adding the value 1 to <code class="language-plaintext highlighter-rouge">oldValue</code>, using the same rules as for the <strong>+</strong> operator.</li>
    <li>Perform ? <code class="language-plaintext highlighter-rouge">PutValue(lhs, newValue)</code>.</li>
    <li>Return <code class="language-plaintext highlighter-rouge">oldValue</code>.</li>
  </ol>
</blockquote>

<p>The purpose of this course is to help you understand the DNA of JavaScript to better understand when you are doing as a developer.</p>

<p>To translate the above <strong>++</strong> spec into a function, it may look something like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">plusPlus</span><span class="p">(</span><span class="nx">orig_val</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">orig_val_coerced</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">orig_val</span><span class="p">);</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">orig_val_coerced</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">orig_val_coerced</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">5</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">plusPlus</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 5</span>
<span class="nx">x</span><span class="p">;</span> <span class="c1">// 6</span></code></pre></figure>

<p>Whenever there is a divergence between what your brain thinks is happening and what the computer does, that’s where bugs enter the code.</p>

<h3 id="course-overview">Course Overview</h3>

<p>JavaScript can be divided into 3 pillars:</p>

<ol>
  <li>
    <p>Types</p>

    <ul>
      <li>
        <p>Primitive Types</p>
      </li>
      <li>
        <p>Abstract Operations</p>
      </li>
      <li>
        <p>Coercion</p>
      </li>
      <li>
        <p>Equality</p>
      </li>
      <li>
        <p>TypeScript, Flow, etc…</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Scope</p>

    <ul>
      <li>
        <p>Nested Scope</p>
      </li>
      <li>
        <p>Hoisting</p>
      </li>
      <li>
        <p>Closure</p>
      </li>
      <li>
        <p>Modules</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Objects (Oriented)</p>

    <ul>
      <li>
        <p>this</p>
      </li>
      <li>
        <p>class{}</p>
      </li>
      <li>
        <p>Prototypes</p>
      </li>
      <li>
        <p>OO vs. OLOO</p>
      </li>
    </ul>
  </li>
</ol>

<p>It is important to understand all of these pillars of JavaScript to get a better understanding of the language and therefore be more effective in your work.</p>

<h2 id="types">Types</h2>

<h3 id="primitive-types">Primitive Types</h3>

<p>“In JavaScript, everything is an object.” - <strong>false</strong></p>

<p>This is not an accurate statement. Many things in JavaScript behave like objects, but that does not make them objects. The spec lays it out. The primitive types are: Undefined, Null, Boolean, String, Symbol, Number, and Object.</p>

<ul>
  <li>
    <p>undefined - has one and only one value; undefined</p>
  </li>
  <li>
    <p>string - any value wrapped in quotes (single or double)</p>
  </li>
  <li>
    <p>number - refers to all of JavaScript’s numbers</p>
  </li>
  <li>
    <p>boolean - the values <code class="language-plaintext highlighter-rouge">true</code> and <code class="language-plaintext highlighter-rouge">false</code></p>
  </li>
  <li>
    <p>object - <code class="language-plaintext highlighter-rouge">{}</code></p>
  </li>
  <li>
    <p>symbol - used mostly to create ‘pseudo’ private-keys</p>
  </li>
  <li>
    <p>undeclared - is this a type? not exactly, but it does have a behavior</p>
  </li>
  <li>
    <p>null - defined as a type, but its behavior is quirky. More details on this later.</p>
  </li>
  <li>
    <p>function - not listed [in the spec] as a type, but functions do have a very specific set of attributes that could make a function considered to be a type. Technically referred to as a sub-type of an object.</p>
  </li>
  <li>
    <p>array - numerically indexed, lengths assigned. Another sub-type to an object.</p>
  </li>
  <li>
    <p>bigint - not in the spec, but likely coming to the spec. When it does land in the spec, it will be a primitive type.</p>
  </li>
</ul>

<p>Defining/assigning a type when developing typically indicates that you expect your data to behave in a certain way. You should be defining your data w/ intent and understanding. Most of the above are not objects, so it is not correct to say that everything is an object in JavaScript. Variables don’t have types, values do.</p>

<h3 id="typeof-operator">typeof Operator</h3>

<p>When we assign a value to a variable, we can use the <code class="language-plaintext highlighter-rouge">typeof</code> operator to determine the type of the value stored in the variable. <code class="language-plaintext highlighter-rouge">undefined</code> is the default value assigned to a variable when a value is not assigned. <code class="language-plaintext highlighter-rouge">undefined</code> does not mean no value, but a value of <code class="language-plaintext highlighter-rouge">undefined</code>. <code class="language-plaintext highlighter-rouge">typeof</code> when applied to a variable storing a function will return ‘function’, which is not a primitive type.</p>

<h3 id="bigint">BigInt</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="mi">42</span><span class="nx">n</span><span class="p">;</span>

<span class="k">typeof</span> <span class="nx">v</span><span class="p">;</span> <span class="c1">// "bigint"</span></code></pre></figure>

<p>Coming soon functionality, does not behave like a standard number primitive type. It will be important to know the difference between a ‘number’ and a ‘bigint’.</p>

<h3 id="kinds-of-emptiness">Kinds of Emptiness</h3>

<p>undefined vs. undeclared vs. uninitialized</p>

<p>These words are not synonymous, in JavaScript they are two entirely different concepts. <code class="language-plaintext highlighter-rouge">undeclared</code> means that the variable does not exist, <code class="language-plaintext highlighter-rouge">undefined</code> means that the variable exists, but has no value. <code class="language-plaintext highlighter-rouge">uninitialized</code> means the variable has never been initialized.</p>

<h3 id="nan--isnan">NaN &amp; isNaN</h3>

<p>NaN does not mean ‘not a number’, it means ‘invalid number’. Zero is not a number to use when you would like to indicate that there is no value, because zero has value. NaN is basically a number that has no value. NaN with any other mathematically valid number will return NaN. NaN is not equal to NaN. NaN is the only value that is not equal to itself. The <code class="language-plaintext highlighter-rouge">isNan</code> utility coerces values to numbers before checking its value. <code class="language-plaintext highlighter-rouge">Number.isNan</code> does not do any coercion. Using this utility, you can determine with certainty whether a value is actually NaN or not; returns <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>. <code class="language-plaintext highlighter-rouge">typeof NaN</code> is a number.</p>

<h3 id="negative-zero">Negative Zero</h3>

<p>The negative representation of the value zero. If you stringify -0, it returns as ‘0’. <code class="language-plaintext highlighter-rouge">-0 === 0</code> ? <code class="language-plaintext highlighter-rouge">true</code> negative zero is neither less than or greater than zero. Enter <code class="language-plaintext highlighter-rouge">Object.is()</code> which allows you to test for the negative zero. It can also be used to check NaN values. A negative zero could be used to track the direction an element was traveling when it gets to zero. If an element was traveling in a negative direction (towards zero), when it gets to zero, it would be useful to denote which direction it was traveling rather than just zero. Negative zero to the rescue!</p>

<h3 id="type-check-exercise">Type Check Exercise</h3>

<p>Make a Polyfill for <code class="language-plaintext highlighter-rouge">Object.is(..)</code></p>

<ol>
  <li>
    <p>`Object.is(..)1 should take two parameters.</p>
  </li>
  <li>
    <p>It should return <code class="language-plaintext highlighter-rouge">true</code> if the passed in parameters are exactly the same value (not just <code class="language-plaintext highlighter-rouge">===</code>), or <code class="language-plaintext highlighter-rouge">false</code> otherwise.</p>
  </li>
  <li>
    <p>For <code class="language-plaintext highlighter-rouge">NaN</code> testing, you can use <code class="language-plaintext highlighter-rouge">Number.isNan(..)</code>, but first see if you can find a way to test without usage of any utility?</p>
  </li>
  <li>
    <p>For <code class="language-plaintext highlighter-rouge">-0</code> testing, no built-in utility exists, but here’s a hint: <code class="language-plaintext highlighter-rouge">-Infinity</code>.</p>
  </li>
  <li>
    <p>If the parameters are any other values, just test them for strict equality.</p>
  </li>
  <li>
    <p>You cannot use the built-in <code class="language-plaintext highlighter-rouge">Object.is(..)</code></p>
  </li>
</ol>

<p><strong>Polyfill Pattern</strong></p>

<blockquote>
  <p>Note: Since your JS environment probably already has <code class="language-plaintext highlighter-rouge">Object.is(..)</code>, to test your polyfill you’ll have to first unconditionally define it (no <code class="language-plaintext highlighter-rouge">if</code> guard), and then add the <code class="language-plaintext highlighter-rouge">if</code> guard when you’re done.</p>
</blockquote>

<p>To define a polyfill, it looks like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">is</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">ObjectIs</span><span class="p">(..)</span> <span class="p">{..};</span>
<span class="p">}</span></code></pre></figure>

<p>In the (Code Exercises)[https://static.frontendmasters.com/resources/2019-03-07-deep-javascript-v2/deep-js-foundations-v2-exercises.zip], the file <code class="language-plaintext highlighter-rouge">types-exercises &gt; object-is &gt; ex.js</code> you will find the file that has all of the <code class="language-plaintext highlighter-rouge">Object.is(..)</code> tests.</p>

<h3 id="type-check-exercise-solution">Type Check Exercise Solution</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span> <span class="o">||</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">is</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">ObjectIs</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xNegZero</span> <span class="o">=</span> <span class="nx">isItNegZero</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">yNegZero</span> <span class="o">=</span> <span class="nx">isItNegZero</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">xNegZero</span> <span class="o">||</span> <span class="nx">yNegZero</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">xNegZero</span> <span class="o">&amp;&amp;</span> <span class="nx">yNegZero</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isItNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isItNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">x</span> <span class="o">===</span> <span class="nx">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">isItNegZero</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">v</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">v</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">isItNaN</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">v</span> <span class="o">!==</span> <span class="nx">v</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span></code></pre></figure>

<h3 id="fundamental-objects">Fundamental Objects</h3>

<p>In addition to Primitive Values are Fundamental Objects. AKA Built-In Objects or Native Functions. Under the following circumstances, it is recommended to use the <code class="language-plaintext highlighter-rouge">new</code> keyword:</p>

<ul>
  <li>
    <p>Object()</p>
  </li>
  <li>
    <p>Array()</p>
  </li>
  <li>
    <p>Function()</p>
  </li>
  <li>
    <p>Date()</p>
  </li>
  <li>
    <p>RegExp()</p>
  </li>
  <li>
    <p>Error()</p>
  </li>
</ul>

<p>And with these, it is not recommended to use the <code class="language-plaintext highlighter-rouge">new</code> keyword:</p>

<ul>
  <li>
    <p>String()</p>
  </li>
  <li>
    <p>Number()</p>
  </li>
  <li>
    <p>Boolean()</p>
  </li>
</ul>

<p>They can be used with <code class="language-plaintext highlighter-rouge">new</code>, but you should not use that keyword with them. <code class="language-plaintext highlighter-rouge">String(), Number(), and Boolean()</code> automatically coerce whatever value is passed into them into that Primitive Type, and that behavior is more useful than making an object out of them.</p>

<h2 id="coercion">Coercion</h2>

<h3 id="abstract-operations">Abstract Operations</h3>

<p>From ECMAScript documentation:</p>

<blockquote>
  <p>The ECMAScript language implicitly performs automatic type conversion as needed. To clarify the semantics of certain constructs it is useful to define a set of conversion abstract operations. The conversion abstract operations are polymorphic; they can accept a value of any ECMAScript language type. But no other specification types are used with these operations.</p>
</blockquote>

<p>AKA coercion</p>

<p>The first abstract operation we are looking at is <code class="language-plaintext highlighter-rouge">ToPrimitive</code>. This abstract operation takes an optional <code class="language-plaintext highlighter-rouge">type</code> hint. The algorithms in JavaScript are recursive, so if we pass something that cannot be coerced into a Primitive Type, <code class="language-plaintext highlighter-rouge">ToPrimitive()</code> will re-run until it either finds a type that it can set or error out. The way that <code class="language-plaintext highlighter-rouge">ToPrimitive</code> works is, by way of hint, trying either <code class="language-plaintext highlighter-rouge">valueOf()</code> or <code class="language-plaintext highlighter-rouge">toString()</code> the order of which depends on the ‘hint’ you have passed in (number or string).</p>

<h3 id="tostring">toString</h3>

<p><code class="language-plaintext highlighter-rouge">ToString</code> takes any value and gives us the representation of that value in string form. One of the corner-cases of <code class="language-plaintext highlighter-rouge">ToString</code> is that is coerces ‘-0’ to ‘0’. Calling <code class="language-plaintext highlighter-rouge">ToString</code> on an array removes the brackets, nulls and undefined(s) get left out. On an object, <code class="language-plaintext highlighter-rouge">ToString</code> will write “[object Object]”. You can overwrite <code class="language-plaintext highlighter-rouge">ToString</code> to behave however you want i.e. JSON.stringify an object.</p>

<h3 id="tonumber">toNumber</h3>

<p><code class="language-plaintext highlighter-rouge">ToNumber</code> takes any value and gives us the representation of that value in numeric form. One strange behavior is turning empty quotes to the number 0. It strips off leading zeros and can handle hexadecimal values. <code class="language-plaintext highlighter-rouge">null</code> is coerced to ‘0’ and <code class="language-plaintext highlighter-rouge">undefined</code> is ‘NaN’. When <code class="language-plaintext highlighter-rouge">ToNumber</code> is used on an object, the algorithm will eventually hit ‘valueOf()’ and then ‘toString()’ and return <code class="language-plaintext highlighter-rouge">NaN</code>. On an array, empty strings are coerced to 0.</p>

<h3 id="toboolean">toBoolean</h3>

<p>Anytime you have any value that is not a boolean and you need a boolean value, <code class="language-plaintext highlighter-rouge">ToBoolean()</code> will eventually be used. Essentially, there is a lookup table that qualifies values as either Falsy or Truthy. Falsy values are: <code class="language-plaintext highlighter-rouge">"", 0, -0, null, NaN, false, undefined</code> Truthy values are basically any value not listed under ‘falsy values’, some examples: <code class="language-plaintext highlighter-rouge">"foo", 23, {a:1}, [1,3], true, function(){..}</code>. The list of truthy values is quite long.</p>

<h3 id="cases-of-coercion">Cases of Coercion</h3>

<p>Template literal strings (available since ES6) coerce values into different types. The plus operator spec states that if either side of the plus is a string, the <code class="language-plaintext highlighter-rouge">ToString</code> method will be invoked. The remainder of this section stresses the importance of understanding when and why coercion occurs and being intentional with how you are using it in your applications. For <code class="language-plaintext highlighter-rouge">Boolean</code> values specifically, the instructor recommends only coercing <code class="language-plaintext highlighter-rouge">undefined, null, or {}</code>. There are too many corner cases with numbers and strings to make using <code class="language-plaintext highlighter-rouge">Boolean</code> coercion make sense.</p>

<h3 id="boxing">Boxing</h3>

<p>Accessing methods on primitive values occurs through a process called boxing, which is a form of implicit coercion. All programming languages have type conversions, because it is absolutely necessary. You will always have cases where you have a string where you need to deal with it as a number or a number that you have to deal with as a boolean.</p>

<h3 id="corner-cases-of-coercion">Corner Cases of Coercion</h3>

<p>It is impossible to design a system that will not have corner cases. A lot of the corner cases have to deal with <code class="language-plaintext highlighter-rouge">Number</code>, <code class="language-plaintext highlighter-rouge">String</code> has a few as well. If you construct an instance of the boolean object and pass in false, it will return true. Not only does an empty string become zero, but so does any string that is full of white space. Booleans implicitly coerce themselves to numbers, which can be dangerous!</p>

<h2 id="philosophy-of-coercion">Philosophy of Coercion</h2>

<h3 id="intentional-coercion">Intentional Coercion</h3>

<p>You cannot deal with type conversion corner cases by avoiding coercions. Instead, you have to adapt a coding style that makes value types plain and obvious. A quality JavaScript program embraces coercions, making sure the types involved in every operation are clear. Thus, corner cases are safely managed. Within your programs, you get to decide how to deal with coercion and it is in your best interest to pay attention to what you are doing by making them obvious in your code. JavaScript’s dynamic typing is not a weakness, it is one of its strong qualities. It’s one of the reasons JavaScript is so ubiquitous.</p>

<h3 id="culture-of-learning">Culture of Learning</h3>

<p>You should use the tools as effectively as you can and when someone is on your code base that does not quite understand, you should work with them to raise their level of understanding. On our development teams, we should promote advancement amongst all team members. Be effective with your communication by writing clear and communicative code.</p>

<h3 id="code-communication-qa">Code Communication Q&amp;A</h3>

<p>You should not rely on code comments as a crutch for the code to explain itself. Code comments should tell you why something is doing something.</p>

<h3 id="implicit-coercion">Implicit Coercion</h3>

<p>Most developers tend to think that implicit mechanisms are magical. That when something happens behind the scenes and it wasn’t obvious, then it’s some sort of magic. And we tend to equate magic with bad. This is a predominant reason why anti-coercion perspective exists, because people feel like the implicitness of coercion is the downfall. Where they point to the explicitness of type casting in something like Java or C++. Like you would never automatically convert a number into some sort of float or something, but JavaScript does all this sort of automatic stuff and then they say that’s a weakness of JavaScript because it’s  magical and bad. It is actually neither bad nor magical, but abstraction.</p>

<p>Not all abstractions are good, but some are necessary. Implicitness, in functional programming, actually makes the implicitness more explicit. Implicitness is not bad, it is the proper use of abstraction. We want to hide key unnecessary details to re-focus the reader and increase clarity. Part of the reason that JavaScript has such a low point of entry is that it does not force the user to focus on such fine details. It would betray JavaScript’s DNA to say that anything implicit should be avoided. Take the following examples:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">numStudents</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="s2">`There are </span><span class="p">${</span><span class="nb">String</span><span class="p">(</span><span class="nx">numStudents</span><span class="p">)}</span><span class="s2"> students.`</span>
<span class="p">);</span>
<span class="c1">// "There are 16 students."</span>

<span class="kd">var</span> <span class="nx">numStudents</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="s2">`There are </span><span class="p">${</span><span class="nx">numStudents</span><span class="p">}</span><span class="s2"> students.`</span>
<span class="p">);</span>
<span class="c1">// "There are 16 students."</span></code></pre></figure>

<p>The second example is more readable and is a fine example of implicit coercion not being a bad or magical thing. And in this example:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshopEnrollment1</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">workshopEnrollment2</span> <span class="o">=</span> <span class="nx">workshop2Elem</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">workshopEnrollment1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">workshopEnrollment2</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nx">workshopEnrollment1</span> <span class="o">&lt;</span> <span class="nx">workshopEnrollment2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span></code></pre></figure>

<p>If both of the numbers are strings, JavaScript wouldn’t turn them into numbers, the less than operator will do an alphanumeric comparison. Again, if you can guarantee that each of the variables for the less than comparison would be numbers, then the second version of the if statement is just fine and we can deal with implicit coercion without fear. If you have the choice to use coercion but it’s not obvious, it would be in your purview to make it obvious. If you communicate your intent, it will not trip up other readers of your code. Is showing the extra details helpful to the reader (of your code) or not? Sometimes yes, sometimes no. Be a critical and analytical thinker, be an engineer and not a code monkey!</p>

<h3 id="understanding-features">Understanding Features</h3>

<p><strong>“If a feature is sometimes useful and sometimes dangerous and if there is a better option then always use the better option”.</strong></p>

<p><strong>–Doug Crawford</strong></p>

<p>But what is useful and what is dangerous? Only what Doug thinks is useful or dangerous? Is there a universal definition for what is useful or dangerous? And what about ‘better option’? How is that measured? This statement is not useful in its abstract sense.</p>

<p>As defined by the instructor:</p>

<p>Useful: When the reader is focused on what is important.</p>

<p>Dangerous: When the reader cannot tell what will happen.</p>

<p>Better: When the reader understands the code.</p>

<p>The takeaway is this; It is irresponsible to knowingly avoid usage of a feature that can improve code readability.</p>

<h3 id="coercion-exercise">Coercion Exercise</h3>

<p><strong>Working With Coercion</strong></p>

<p>In this exercise, you will define some validation functions that check user inputs (such as from DOM elements). You’ll need to properly handle the coercions of the various value types.</p>

<p><strong>Instructions</strong></p>

<ol>
  <li>
    <p>Define an <code class="language-plaintext highlighter-rouge">isValidName(..)</code> validator that takes one parameter, <code class="language-plaintext highlighter-rouge">name</code>. The validator returns <code class="language-plaintext highlighter-rouge">true</code> if all the following match the parameter (<code class="language-plaintext highlighter-rouge">false</code> otherwise):</p>

    <ul>
      <li>must be a string</li>
      <li>must be non-empty</li>
      <li>must contain non-whitespace of at least 3 characters</li>
    </ul>
  </li>
  <li>
    <p>Define an <code class="language-plaintext highlighter-rouge">hoursAttended(..)</code> validator that takes two parameters, <code class="language-plaintext highlighter-rouge">attended</code> and <code class="language-plaintext highlighter-rouge">length</code>. The validator returns <code class="language-plaintext highlighter-rouge">true</code> if all the following match the two parameters (<code class="language-plaintext highlighter-rouge">false</code> otherwise):</p>

    <ul>
      <li>either parameter may only be a string or number</li>
      <li>both parameters should be treated as numbers</li>
      <li>both numbers must be 0 or higher</li>
      <li>both numbers must be whole numbers</li>
      <li><code class="language-plaintext highlighter-rouge">attended</code> must be less than or equal to <code class="language-plaintext highlighter-rouge">length</code></li>
    </ul>
  </li>
</ol>

<h3 id="coercion-exercise-solution">Coercion Exercise Solution</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">isValidName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="k">typeof</span> <span class="nx">name</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
        <span class="nx">name</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">3</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">hoursAttended</span><span class="p">(</span><span class="nx">attended</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="k">typeof</span> <span class="nx">attended</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
        <span class="nx">attended</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">!=</span> <span class="dl">""</span> 
    <span class="p">)</span> <span class="p">{</span>
        <span class="nx">attended</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">attended</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="k">typeof</span> <span class="nx">length</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
        <span class="nx">length</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">!=</span> <span class="dl">""</span> 
    <span class="p">)</span> <span class="p">{</span>
        <span class="nx">length</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">length</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="k">typeof</span> <span class="nx">attended</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
        <span class="k">typeof</span> <span class="nx">length</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
        <span class="nx">attended</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="nb">Number</span><span class="p">.</span><span class="nx">isInteger</span><span class="p">(</span><span class="nx">attended</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nb">Number</span><span class="p">.</span><span class="nx">isInteger</span><span class="p">(</span><span class="nx">length</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">attended</span> <span class="o">&lt;=</span> <span class="nx">length</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span></code></pre></figure>


</details>

<h2 id="equality">Equality</h2>

<h3 id="double--triple-equals">Double &amp; Triple Equals</h3>

<p><code class="language-plaintext highlighter-rouge">==</code> checks value (loose) and <code class="language-plaintext highlighter-rouge">===</code> checks value and type (strict)? This is a very common misconception. <strong>If you’re trying to understand your code, it’s critical that you learn to think like JavaScript.</strong>  Check the JavaScript specification for <a href="https://www.ecma-international.org/ecma-262/9.0/index.html#sec-abstract-equality-comparison">Abstract Equality Comparison</a> and <a href="https://www.ecma-international.org/ecma-262/9.0/index.html#sec-strict-equality-comparison">Strict Equality Comparison</a> to dig deeper into the difference between <code class="language-plaintext highlighter-rouge">==</code> and <code class="language-plaintext highlighter-rouge">===</code>. When the types of the two elements you are comparing with <code class="language-plaintext highlighter-rouge">==</code> are the same, then (according to the spec) the <code class="language-plaintext highlighter-rouge">===</code> is performed. Ideally, you should try to have the value types and make that obvious as much as possible. You should not be doing equality comparisons when you have no idea what the types are.</p>

<p>For <code class="language-plaintext highlighter-rouge">===</code> if the types are different, it returns <code class="language-plaintext highlighter-rouge">false</code>. The basic difference between <code class="language-plaintext highlighter-rouge">==</code> and <code class="language-plaintext highlighter-rouge">===</code> is whether or not we are going to allow any coercion to occur. JavaScript’s equality is based on identity, not structure. Consider the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">workshop1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Deep JS Foundations</span><span class="dl">"</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">workshop2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Deep JS Foundations</span><span class="dl">"</span>
<span class="p">};</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">workshop1</span> <span class="o">==</span> <span class="nx">workshop2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// never going to get here...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">workshop1</span> <span class="o">===</span> <span class="nx">workshop2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// never going to get here...</span>
<span class="p">}</span></code></pre></figure>

<p>While, the above elements may be of the same type, they are effectively different from one another. However, if <code class="language-plaintext highlighter-rouge">workshop2 = workshop1</code> then we could get a true statement to return from a comparison of these two objects.</p>

<p>In summary, <code class="language-plaintext highlighter-rouge">==</code> allows coercion (types different), <code class="language-plaintext highlighter-rouge">===</code> disallows coercion (types same).</p>

<h3 id="coercive-equality">Coercive Equality</h3>

<p><em>Like every other operation, is coercion helpful in an equality comparison or not?</em> You should consider that statement whenever making a decision to use coercion. Again, driving home the point to be a critical, analytical thinker vs. a code monkey. The decision between using <code class="language-plaintext highlighter-rouge">==</code> or <code class="language-plaintext highlighter-rouge">===</code> is a trailing indicator to whether you truly understand your program or not. It is perhaps better to get to the root of why you would be using <code class="language-plaintext highlighter-rouge">===</code>… do you truly not know what <code class="language-plaintext highlighter-rouge">types</code> of data your function will be working with? How can you fix that? If you can solve this issue, deciding and making obvious what your types are, you will find that you have better code with fewer bugs.</p>

<p>Through coercive equality, you have the option to treat the <code class="language-plaintext highlighter-rouge">null</code> and <code class="language-plaintext highlighter-rouge">undefined</code> values as equal (read the spec…). Which of the following is ‘better’?:</p>

<details>
    <summary>Click to view the code
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop1</span> <span class="o">=</span> <span class="p">{</span> <span class="na">topic</span><span class="p">:</span> <span class="kc">null</span> <span class="p">};</span>
<span class="kd">var</span> <span class="nx">workshop2</span> <span class="o">=</span> <span class="p">{};</span>

<span class="k">if</span> <span class="p">(</span>
    <span class="p">(</span><span class="nx">workshop1</span><span class="p">.</span><span class="nx">topic</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">workshop1</span><span class="p">.</span><span class="nx">topic</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
    <span class="p">(</span><span class="nx">workshop2</span><span class="p">.</span><span class="nx">topic</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">workshop2</span><span class="p">.</span><span class="nx">topic</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span>
    <span class="nx">workshop1</span><span class="p">.</span><span class="nx">topic</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
    <span class="nx">workshop2</span><span class="p">.</span><span class="nx">topic</span> <span class="o">==</span> <span class="kc">null</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">}</span></code></pre></figure>


</details>

<p>Arguably, the second <code class="language-plaintext highlighter-rouge">if</code> statement is more concise and readable, and since we know that <code class="language-plaintext highlighter-rouge">null == undefined</code> this would work exactly the same as the first <code class="language-plaintext highlighter-rouge">if</code> statement. This is an example of using coercive equality.</p>

<h3 id="double-equals-algorithm">Double Equals Algorithm</h3>

<p>According to the Abstract Equality Comparison algorithm, if one of the operators is a number and the other is a string or boolean, it will convert the non-numeric operator into a number using <code class="language-plaintext highlighter-rouge">ToNumber()</code>. Whether or not you like how the algorithm functions is not relevant, understanding how it works and why you’ve received a certain outcome from using the algorithm is what matters.</p>

<p><strong><code class="language-plaintext highlighter-rouge">==</code> prefers numeric comparison.</strong></p>

<p>Considering the above, which of the below <code class="language-plaintext highlighter-rouge">if</code> statements is more concise?</p>

<details>
    <summary>Click to view the code
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshopEnrollment1</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">workshopEnrollment2</span> <span class="o">=</span> <span class="nx">workshop2Elem</span><span class="p">.</span><span class="nx">value</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">workshopEnrollment1</span><span class="p">)</span> <span class="o">===</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">workshopEnrollment2</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">workshopEnrollment1</span> <span class="o">==</span> <span class="nx">workshopEnrollment2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">}</span></code></pre></figure>


</details>

<p>Arguably, the second comparison is cleaner, especially if we can guarantee that either variable will only ever be a number or a string. The coercion that would occur from using <code class="language-plaintext highlighter-rouge">==</code> would be acceptable for this use case. You can choose to structure your code in such a way that coercion is a useful and obvious system, rather than the complex magic that some people feel it to be. If you invoke <code class="language-plaintext highlighter-rouge">==</code> with something that is not already of a primitive type, it will invoke <code class="language-plaintext highlighter-rouge">ToPrimitive()</code> on that.</p>

<h3 id="double-equals-walkthrough">Double Equals Walkthrough</h3>

<p>If you wrote a function like this:</p>

<details>
    <summary>Click to view the code
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop1Count</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">workshop2Count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">workshop1Count</span> <span class="o">==</span> <span class="nx">workshop2Count</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">}</span></code></pre></figure>


</details>

<p>What would happen? Would it work coercively? In the above case, yes… but should it? More importantly, why would it work? Why would a number somehow be coercively equal to an array holding that number? According to the specification, the <code class="language-plaintext highlighter-rouge">==</code> algorithm would execute in the following way:</p>

<details>
    <summary>Click to view the code
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop1Count</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">workshop2Count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">];</span>

<span class="c1">// if (workshop1Count == workshop2Count) {</span>
<span class="c1">// if (42 == "42") {</span>
<span class="c1">// if (42 === 42) {</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">}</span></code></pre></figure>


</details>

<p>The array gets transformed into its primitive type, which is a stringified version of the array (“42”). Then, 42 is compared to the string “42”. The <code class="language-plaintext highlighter-rouge">==</code> algorithm prefers numeric comparison, therefore the string “42” is now turned into the number 42. And now that both operators are the same type, <code class="language-plaintext highlighter-rouge">==</code> will do a <code class="language-plaintext highlighter-rouge">===</code> comparison and finally return true. All of this is an example of when coercion could be a bad thing for a developer. Just because this works does not mean that you should use it. You should reduce the surface area and not make a comparison between numbers and arrays of numbers. The fix for this would not be to use a <code class="language-plaintext highlighter-rouge">===</code> comparison, but to actually fix the problem, the comparison between two things that are not the same type. Fix it so that the comparisons that you are making make sense.</p>

<h3 id="double-equals-summary">Double Equals Summary</h3>

<p>If the types are the same: <code class="language-plaintext highlighter-rouge">===</code>
If <code class="language-plaintext highlighter-rouge">null</code> or <code class="language-plaintext highlighter-rouge">undefined</code>: equal
If non-primitives: <code class="language-plaintext highlighter-rouge">ToPrimitive()</code>
Prefer: <code class="language-plaintext highlighter-rouge">ToNumber()</code></p>

<h3 id="double-equals-corner-cases">Double Equals Corner Cases</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[]</span> <span class="o">==</span> <span class="o">!</span><span class="p">[];</span> <span class="c1">// true</span>

<span class="c1">// Under no circumstances would you compare a value to the negation of itself. BUT... here's why it works</span>

<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// if(a == !b) {</span>
<span class="c1">// if([] == false) { reduce a to its value, an array, and negate b, an array which is truthy</span>
<span class="c1">// if("" == false) { non-primitive compared to a primitive, turn the array into a primitive, it becomes a string</span>
<span class="c1">// if(0 == false) { non-same types, convert to a number</span>
<span class="c1">// if(0 == 0) {</span>
<span class="k">if</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Works...</span>
<span class="p">}</span>

<span class="c1">// This is the more sensible AND likely way you may use coercion in development, by comparing</span>
<span class="c1">// whether two variables of the same type are equal to one another</span>

<span class="c1">// if (a != b) {</span>
<span class="c1">// if (!(a == b)) {</span>
<span class="c1">// if (!(false)) {</span>
<span class="k">if</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Works...</span>
<span class="p">}</span></code></pre></figure>

<h3 id="corner-cases-booleans">Corner Cases: Booleans</h3>

<p>Just don’t do this… If you want to all the boolean conversion of an array to be true, that’s fine.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// if(a) {</span>
<span class="c1">// if(Boolean(a)) {</span>
<span class="k">if</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// the if statement will invoke the toBoolean operation on the array </span>
    <span class="c1">// Works...</span>
<span class="p">}</span>

<span class="c1">// if (a == true) { converts non-primitive [] to a primitive</span>
<span class="c1">// if ("" == true) { [] becomes a string</span>
<span class="c1">// if (0 === 1) { converts both to numbers</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Nope...</span>
<span class="p">}</span>

<span class="c1">// if (a == false) { converts non-primitive [] to a primitive</span>
<span class="c1">// if ("" == false) { [] becomes a string</span>
<span class="c1">// if (0 === 0) { converts both to numbers</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Works...</span>
<span class="p">}</span></code></pre></figure>

<p>The comparison of <code class="language-plaintext highlighter-rouge">[] == true || false</code> is unnecessarily complicating the above code. It is simpler, and also more understandable, to just have JavaScript perform the <code class="language-plaintext highlighter-rouge">Boolean</code> operation on the original array instead of comparing it to true or false. In this case, implicit coercion does not have a gotcha whereas the explicit coercion does.</p>

<h3 id="corner-cases-summary">Corner Cases: Summary</h3>

<p>How to avoid these corner cases with <code class="language-plaintext highlighter-rouge">==</code>.</p>

<p><strong>Avoid</strong></p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">==</code> with 0 or “” or “ “ - when either value of the comparison can one of these values</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">==</code> with non-primitives</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">==</code> true or <code class="language-plaintext highlighter-rouge">==</code> false : allow ToBoolean or use <code class="language-plaintext highlighter-rouge">===</code></p>
  </li>
</ol>

<h3 id="the-case-for-double-equals">The Case for Double Equals</h3>

<p>You should prefer <code class="language-plaintext highlighter-rouge">==</code> in all cases. Knowing <code class="language-plaintext highlighter-rouge">types</code> is always better than not knowing them. Static Types is <strong>not</strong> the only (or even necessarily best) way to know your types. <code class="language-plaintext highlighter-rouge">==</code> is not about comparisons with unknown types. It’s best to not use <code class="language-plaintext highlighter-rouge">==</code> when you do not know the types. <code class="language-plaintext highlighter-rouge">==</code> is about comparisons with known types, optionally when conversions are helpful.</p>

<p>If you know the types in a comparison:</p>

<p>If both types are the same, <code class="language-plaintext highlighter-rouge">==</code> is identical to <code class="language-plaintext highlighter-rouge">===</code></p>

<p>Using <code class="language-plaintext highlighter-rouge">===</code> would be unnecessary so prefer the shorter <code class="language-plaintext highlighter-rouge">==</code></p>

<p>If the types are different, using <code class="language-plaintext highlighter-rouge">===</code> would break</p>

<p>Prefer the more powerful <code class="language-plaintext highlighter-rouge">==</code> or don’t compare at all</p>

<p>If the types are different, the equivalent of <code class="language-plaintext highlighter-rouge">==</code> would  be  two (or more) <code class="language-plaintext highlighter-rouge">===</code> (i.e. slower)</p>

<p>Prefer the faster <code class="language-plaintext highlighter-rouge">==</code> over multiple <code class="language-plaintext highlighter-rouge">===</code></p>

<p>If the types are different, two (or more) <code class="language-plaintext highlighter-rouge">===</code> comparisons may distract the reader</p>

<p>Prefer the cleaner <code class="language-plaintext highlighter-rouge">==</code></p>

<p>All of the above suggestions are only applicable if you can ensure that the reader of your code can be certain of your types. When you know the types, <code class="language-plaintext highlighter-rouge">==</code> is the more sensible choice.</p>

<p>If you do not know the types:</p>

<p>Not knowing the types means not fully understanding the code</p>

<p>If possible, refactor the code</p>

<p>The uncertainty of not knowing the types should be obvious to the reader</p>

<p>The most obvious signal about the uncertainty of types is <code class="language-plaintext highlighter-rouge">===</code></p>

<p>Not knowing the types is equivalent to assuming type conversion / coercion</p>

<p>Because of corner cases, the only <em>safe</em> choice is <code class="language-plaintext highlighter-rouge">===</code></p>

<p>If you can’t or won’t use known and obvious types, <code class="language-plaintext highlighter-rouge">===</code> is the only reasonable choice. Even if <code class="language-plaintext highlighter-rouge">===</code> would always be equivalent to <code class="language-plaintext highlighter-rouge">==</code> in your code, using it <em>everywhere</em> sends a wrong semantic signal: “Protecting myself since I don’t know/trust the types”. Making your types known and obvious leads to better code. If types are known, <code class="language-plaintext highlighter-rouge">==</code> is best. Otherwise, fall back to <code class="language-plaintext highlighter-rouge">===</code>.</p>

<h3 id="equality-exercise">Equality Exercise</h3>

<h4 id="wrangling-equality">Wrangling Equality</h4>

<p>In this exercise, you will define a <code class="language-plaintext highlighter-rouge">findAll(..)</code> function that searches an array and returns an array with all coercive matches.</p>

<h5 id="instructions">Instructions</h5>

<ol>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">findAll(..)</code> function takes a value and an array. It returns an array.</p>
  </li>
  <li>
    <p>The coercive matching that is allowed:</p>

    <ul>
      <li>exact matches (<code class="language-plaintext highlighter-rouge">Object.is(..)</code>)</li>
      <li>strings (except “” or whitespace-only) can match numbers</li>
      <li>numbers (except <code class="language-plaintext highlighter-rouge">NaN</code> and <code class="language-plaintext highlighter-rouge">+/- Infinity</code>) can match strings (hint: watch out for <code class="language-plaintext highlighter-rouge">-0</code>!)</li>
      <li><code class="language-plaintext highlighter-rouge">null</code> can match <code class="language-plaintext highlighter-rouge">undefined</code>, and vice versa</li>
      <li>booleans can only match booleans</li>
      <li>objects only match the exact same object</li>
    </ul>
  </li>
</ol>

<h3 id="equality-exercise-solution">Equality Exercise Solution</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">findAll</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">match</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">boolean</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">v</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">boolean</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">==</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">match</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">!=</span> <span class="dl">""</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">v</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">==</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">match</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="kc">NaN</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="kc">Infinity</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">v</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">==</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">setsMatch</span><span class="p">(</span><span class="nx">arr1</span><span class="p">,</span><span class="nx">arr2</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">arr1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">arr2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">arr1</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">arr2</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">arr1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">arr2</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// tests:</span>

<span class="kd">var</span> <span class="nx">myObj</span> <span class="o">=</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">2</span> <span class="p">};</span>

<span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">[</span>
	<span class="kc">null</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="kc">NaN</span><span class="p">,</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span> <span class="kc">Infinity</span><span class="p">,</span>
	<span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">42</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">42hello</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">true</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">NaN</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">myObj</span>
<span class="p">];</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">null</span><span class="p">,</span><span class="kc">undefined</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">null</span><span class="p">,</span><span class="kc">undefined</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="o">-</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">13</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">42</span><span class="p">,</span><span class="dl">"</span><span class="s2">42</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">NaN</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">NaN</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="o">-</span><span class="kc">Infinity</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">Infinity</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">Infinity</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="dl">""</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="dl">""</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">42</span><span class="dl">"</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">42</span><span class="p">,</span><span class="dl">"</span><span class="s2">42</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">42hello</span><span class="dl">"</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="dl">"</span><span class="s2">42hello</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">true</span><span class="dl">"</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="dl">"</span><span class="s2">true</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">true</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">false</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="nx">myObj</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="nx">myObj</span><span class="p">])</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">null</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">NaN</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">42</span><span class="p">,</span><span class="dl">"</span><span class="s2">42hello</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="mi">25</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">Infinity</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">Infinity</span><span class="p">,</span><span class="o">-</span><span class="kc">Infinity</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="dl">""</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="dl">""</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">false</span><span class="dl">"</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">false</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">true</span><span class="p">,</span><span class="dl">"</span><span class="s2">true</span><span class="dl">"</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">true</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">setsMatch</span><span class="p">(</span><span class="nx">findAll</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="nx">values</span><span class="p">),[</span><span class="kc">false</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">);</span></code></pre></figure>


</details>

<p>The point of this exercise was to drive home the point that coercion can be safe when you have eliminated the corner cases and made it obvious that you have done so.</p>

<h2 id="static-typing">Static Typing</h2>

<h3 id="typescript--flow">TypeScript &amp; Flow</h3>

<p>The instructor does not use TypeScript or Flow, because he believe that they are solving problems in a way that makes his code worse. But… here are some details:</p>

<p>Benefits:</p>

<ol>
  <li>
    <p>Catch type-related mistakes - very useful!</p>
  </li>
  <li>
    <p>Communicate type intent - makes code more obvious</p>
  </li>
  <li>
    <p>Provides IDE feedback - 🔥</p>
  </li>
</ol>

<p>Caveats:</p>

<ol>
  <li>
    <p>inferencing is best-guess, not a guarantee</p>
  </li>
  <li>
    <p>Annotations are optional - need to opt-in</p>
  </li>
  <li>
    <p>Any part of the application that isn’t typed introduces uncertainty</p>
  </li>
</ol>

<h3 id="inferencing">Inferencing</h3>

<p>Consider the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">You</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// ..</span>

<span class="nx">teacher</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">You</span><span class="dl">"</span> <span class="p">};</span>
<span class="c1">// Error: can't assign object to string</span></code></pre></figure>

<p>The above is an example of static typing that comes with the use of TypeScript or Flow. Because you initially set the value of <code class="language-plaintext highlighter-rouge">teacher</code> to a string, these statically typed systems will infer that <code class="language-plaintext highlighter-rouge">teacher</code> should always be a string… but what if you want to reassign <code class="language-plaintext highlighter-rouge">teacher</code> to hold an object? You’re SOL. You can also strictly declare that <code class="language-plaintext highlighter-rouge">teacher</code> should only ever be a string:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">You</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// ..</span>

<span class="nx">teacher</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">You</span><span class="dl">"</span> <span class="p">};</span>
<span class="c1">// Error: can't assign object to string</span></code></pre></figure>

<p>…and you would of course see the same error as before.</p>

<h3 id="custom-types">Custom Types</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">type</span> <span class="nx">student</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">string</span> <span class="p">};</span>

<span class="kd">function</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">studentRec</span><span class="p">:</span> <span class="nx">student</span><span class="p">):</span> <span class="nx">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">studentRec</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">firstStudent</span><span class="p">:</span> <span class="nx">student</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span> <span class="p">};</span>

<span class="kd">var</span> <span class="nx">firstStudentName</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">getName</span><span class="p">(</span><span class="nx">firstStudent</span><span class="p">);</span></code></pre></figure>

<p>With TypeScript and Flow, you can define custom types. The above defines that an object of a type that has a property called name that is of type string. You can pass values of that type as parameters and receive values back as parameters. Any of the above only works based on the ‘guarantee’ that things are assigned correctly.</p>

<h3 id="validating-operand-types">Validating Operand Types</h3>

<p>Something undervalued about TypeScript is that it can tell us that certain operations would be invalid. The following would produce an error in TypeScript:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">studentName</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">studentCount</span><span class="p">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="nx">studentName</span><span class="p">;</span>
<span class="c1">// error: can't subtract string</span></code></pre></figure>

<p>The only issue with how TypeScript handles the above, in the instructors opinion, is the inability to change how TypeScript handles coercion on a case-by-case basis.</p>

<h3 id="typescript--flow-summary">TypeScript &amp; Flow Summary</h3>

<p>If you are interested in the differences and similarities between TypeScript and Flow, <a href="https://github.com/niieani/typescript-vs-flowtype">check out this article</a>. TypeScript and Flow are very useful in that a lot of people are finding them to be helpful to solve their typing issues, helpful to make their types more obvious. The only issue is that you are unable to configure these.</p>

<h3 id="static-typing-pros">Static Typing Pros</h3>

<p>They make types more obvious in code.</p>

<p>Familiarity: they look like other language’s type systems.</p>

<p>Extremely popular nowadays. With TypeScript coming from Microsoft and Flow coming from Facebook, there is no doubt that these static typing systems are here to stay. Learning and using them is actually a pretty valuable tool to add to your toolset.</p>

<p>They are very sophisticated and good at what they do.</p>

<h3 id="static-typing-cons">Static Typing Cons</h3>

<p>They use “non-JS-standard” syntax (or code comments). It is not very likely that these will be adopted into JavaScript spec.</p>

<p>They require a build process, which raises the barrier to entry. While build processes are common these days, it is nice to be able to just write vanilla JS and load it in the browser.</p>

<p>Their sophistication can be intimidating to those without prior formal types experience. The barrier to entry ramps up very quickly.</p>

<p>They focus more on “static types” (variables, parameters, returns, properties, etc.) than value types. JavaScript is a dynamically typed language, so static typing is kinda weird…</p>

<h3 id="understanding-your-types">Understanding Your Types</h3>

<p>JavaScript has a (dynamic) type system, which uses various forms of coercion for value type conversion, including equality comparisons. However, the prevailing response seems to be: avoid as much of this system as possible, and use <code class="language-plaintext highlighter-rouge">===</code> to “protect” from needing to worry about types. Part of the problem with avoidance of whole swaths of JavaScript, like pretending <code class="language-plaintext highlighter-rouge">===</code> saves you from needing to know types, is that it tends to systemically perpetuate bugs. You cannot write quality JavaScript programs without knowing the types involved in your operations. Alternatively, many choose to adopt a different “static types” system layered on top. While certainly helpful in some respects, this is  “avoidance” of a different sort. Apparently, JavaScript’s type system is inferior, so it must be replaced, rather than learned and leveraged. Many claim that JavaScript’s type system is too difficult for newer devs to learn, and that static types are (somehow) more learnable.</p>

<p>Instructors claim: the better approach is to embrace and learn JavaScript’s type system, and to adopt a coding style which makes types as obvious as possible. By doing so, you will make your code more readable and more robust, for experienced and new developers alike. As an option to aid in that effort, the instructor created <a href="https://github.com/getify/TypL">Typl</a>, which he believes embraces and unlocks the best parts of JavaScript’s types and coercion.</p>

<h2 id="scope">Scope</h2>

<h3 id="scope-1">Scope</h3>

<p>One of the three main pillars of JavaScript is its scope system and how it deals with scope. Specifically, lexical scope. What is the lexical scope mechanism of JavaScript?</p>

<p>Scope is where to look for things. But what are you looking for? All variables in a JavaScript application are either receiving the assignment of a value or you are retrieving the value of a variable. There is not other purpose for the existence of variables in JavaScript programs. It is extremely common for people to think about JavaScript as running top-down, line by line. But JavaScript is not an interpreted language (which would run top-down), it is a compiled language or at the very least, you could say it is parsed. There is some processing that has to happen before execution occurs.</p>

<p>An example of JavaScript being parsed would be having an error somewhere in your code that is thrown at runtime before any JavaScript has even been executed. How did JavaScript know the error was there if it is supposed to execute top-down? There must have been a processing step. Enter compiler theory… In compiler theory, there are essentially four steps (sometimes two are combined, so sometimes there are three steps); lexing and tokenization, parsing (which turns the stream of tokens into an Abstract Syntax Tree), the last step is code generation, which takes the abstract syntax tree and produces some kind of other executable form of the program.</p>

<p>The way that (JavaScript) processing happens before we first execute, is there is a stage where it goes through compilation and parsing, and it produces an abstract syntax tree. It also produces a plan for the lexical environment. That is, where all the lexical scopes are and what is going to be in them. It prepares this plan, and that is the executable code that is handed off to be executed by the other part of the JavaScript engine.</p>

<p>Understanding the above, it is important to think of JavaScript as a two-pass system rather than a single-pass. JavaScript organizes scopes with functions and blocks.</p>

<h3 id="compilation--scope">Compilation &amp; Scope</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">otherClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Welcome!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ask</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">question</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Why?</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">question</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">otherClass</span><span class="p">();</span> <span class="c1">// Welcome!</span>
<span class="nx">ask</span><span class="p">();</span> <span class="c1">// Why?</span></code></pre></figure>

<p>Looking at the above code, you can likely understand everything that will happen, but is that the entire picture? But how exactly does the JavaScript engine think about / handle this code? To understand the complete picture, we need to consider that JavaScript has both a compiler and a scope manager. These two pieces of JavaScript will help us complete the picture of what <em>exactly</em> is happening with the above code. The compiler and scope manager will have some back and forth while sorting through the JavaScript code to organize the code in terms of global scope and local scope. The first <code class="language-plaintext highlighter-rouge">var</code> and the functions will be in global scope while the <code class="language-plaintext highlighter-rouge">var</code>(s) inside of the functions will be in the local scope of their function(s). This is then handed over, as part of the execution plan, to the virtual (JavaScript) machine can run this code.</p>

<p>In a lexically scoped language, which JavaScript is, all of the scopes that we are dealing with are determined at compile time, not at run time. This allows the (JavaScript) engine to more efficiently optimize because everything is known.</p>

<h3 id="executing-code">Executing Code</h3>

<p>After the compiler and scope manager have had their pass at the JavaScript code, execution can happen. Now, the ‘conversation’ will be between the scope manager and the virtual machine (JavaScript engine). The virtual machine will try to run the code and at each step will check with the scope manager to see whether the references exist.</p>

<p>Key to understanding lexical scope: If JavaScript cannot find the reference to a variable that was declared within a scope, it (JavaScript) will go up a level (scope) to look for the reference and continue doing so until it finds the reference or has no additional scope to step through.</p>

<h3 id="compilation-and-scope-qa">Compilation and Scope Q&amp;A</h3>

<p>Reread the last two sections or read this <a href="https://astronautweb.co/javascript-lexical-scope/">stolen from here</a>:</p>

<p>A relatively basic concept in JavaScript is that each declared function creates its own scope. What gets a little more mind bending is the concept of a closure - a function which is able to remember and access its lexical scope even when that function is executing outside its lexical scope.</p>

<p>Lexical scope is the scope model used by the JavaScript language, which differs to some other languages which use dynamic scope. Lexical scope is the scope defined at lexing time.</p>

<h4 id="so-what-is-lexing-time">So, what is lexing time?</h4>

<p>This digs into the mechanics of how JavaScript engine works. Despite commonly being referred to as an interpreted language, JavaScript compiles code immediately before executing it. For example the statement: <code class="language-plaintext highlighter-rouge">var a = 2;</code> is split into two separate steps at lexing time:</p>

<p><code class="language-plaintext highlighter-rouge">var a</code> This declares the variable in the scope, before code execution.
<code class="language-plaintext highlighter-rouge">a = 2</code> This assigns the value 2 to the variable a, if it is found in the available scope.
The lexing phase of compilation determines where and how all identifiers are declared, and thus how they will be looked up during execution. This is the same mechanism which results in “hoisting” variables. The variables are not actually moved within the source code, the declarations simply occur during the lexing phase and so the JavaScript engine is aware of these before execution.</p>

<p>Consider these examples:</p>

<p>Example 1:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">a:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span> <span class="c1">// a: 1</span></code></pre></figure>

<p>Example 2:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">a:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span> <span class="c1">// a: undefined</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></code></pre></figure>

<p>Example 3:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">a:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span> <span class="c1">// Uncaught ReferenceError: a is not defined</span></code></pre></figure>

<p>Example 1 is straightforward and works as expected, however note the subtle difference between other two examples. Example 2 logs that the value of a is undefined, but the identifier a has itself been declared; compared with example 3 in which the identifier a has not been declared, hence resulting in a reference error.</p>

<p>This demonstrates that during the lexing phase, the JavaScript engine declares the variables first, before the following step in which the values are assigned to the identifiers - this is hoisting. Because functions are also defined at this time (lexing phase), we can say that lexical scope is based on where variables and blocks of scope exist at author time, and thus are locked down at the end of the lexing phase. Scope is not defined at runtime, rather it can be accessed at runtime.</p>

<p>Again, a closure is when a function is able to remember and access its lexical scope even when that function is executing outside its lexical scope.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>  <span class="c1">// 'scope of foo' aka lexical scope for bar</span>
   <span class="kd">var</span> <span class="nx">memory</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hello closure</span><span class="dl">'</span><span class="p">;</span>
   <span class="k">return</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">memory</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
 
<span class="c1">// returns the bar function and assigns it to the identifier 'closure’;</span>
<span class="kd">const</span> <span class="nx">closure</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>
 
<span class="nx">closure</span><span class="p">();</span> <span class="c1">// hello closure</span></code></pre></figure>

<p>So… lexical scope is the author-time scope created by a closure. It is the ‘outer’ scope of a function which is defined inside a closure.</p>

<h3 id="code-execution-finishing-up">Code Execution: Finishing Up</h3>

<p>Continues walking through the code in the ‘Compilation &amp; Scope’ section above. Nothing that hasn’t already been covered. Reread the first few sections of this unit.</p>

<h3 id="lexical-scope-review">Lexical Scope Review</h3>

<p>JavaScript is not an interpreted language, in the sense that it does not execute code line-by-line. Instead, JavaScript should be thought of as a two-pass processing. The first pass is compilation / parsing, during which the main thing that happens is the scope / plan is created and the identifiers are mapped. The second pass is execution. Let’s walk through some code… again.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">otherClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Welcome!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ask</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">question</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Why?</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">question</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">otherClass</span><span class="p">();</span> <span class="c1">// Welcome!</span>
<span class="nx">ask</span><span class="p">();</span> <span class="c1">// Why?</span></code></pre></figure>

<p>The (compilation) process for the above code is something like this:</p>

<p>Compiler: Hey Scope Manager, I have a formal declaration for a variable called <code class="language-plaintext highlighter-rouge">teacher</code>, have you ever heard of that before?</p>

<p>Scope Manager: No, but I have created it in the global scope.</p>

<p>C: Hey Scope Manager, I have a formal declaration for <code class="language-plaintext highlighter-rouge">otherClass</code>, heard of it?</p>

<p>SM: No, but I have created it in the global scope.</p>

<p>C: BTW, that last thing, that was pointing at a function, so we need a new scope.</p>

<p>SM: Yep.</p>

<p>C: Great, inside of that function’s scope I have another formal declaration for a variable called <code class="language-plaintext highlighter-rouge">teacher</code>, nahmean?</p>

<p>SM: No, but I have created it in the function’s scope.</p>

<p>C: Fine. I have another formal declaration for <code class="language-plaintext highlighter-rouge">ask</code>, have you ever…?</p>

<p>SM: No, but I have created it in the global scope.</p>

<p>C: BTW, that last identifier, <code class="language-plaintext highlighter-rouge">ask</code>, that was pointing at a function, make a new scope.</p>

<p>SM: Yeah, ok. A new scope has been made for the <code class="language-plaintext highlighter-rouge">ask</code> identifier which points at a function.</p>

<p>C: Cool beans. Inside of <em>that</em> function scope, I have a formal declaration for a variable called <code class="language-plaintext highlighter-rouge">question</code>, have you ever?</p>

<p>SM: Nope, but I have created it in the function’s scope.</p>

<p>With no additional declarations in the global scope, the compilation is complete. Time to process / execute the code.</p>

<p>Execution Engine: Hey Scope Manager, I have a target reference for <code class="language-plaintext highlighter-rouge">teacher</code>, ever heard of it?</p>

<p>Scope Manager: Yep, here it is!</p>

<p>EE: Hey Scope Manager, now I have a source reference for <code class="language-plaintext highlighter-rouge">otherClass</code>, have you ever heard of that?</p>

<p>SM: Yep, here it is!</p>

<p>EE: Great. Inside of that scope I have a target reference for <code class="language-plaintext highlighter-rouge">teacher</code>, heard of it?</p>

<p>SM: Yep, here it is!</p>

<p>EE: Ok, now I have a source reference for <code class="language-plaintext highlighter-rouge">console</code>, have you (local scope) ever heard of it?</p>

<p>SM: Nope, let me go up a level (to global scope) and check.</p>

<p>EE: Alright then, global scope, have you ever heard of <code class="language-plaintext highlighter-rouge">console</code>?</p>

<p>SM: Yeah, here it is. You have access to any methods or properties on this object.</p>

<p>EE: 🔥❗️ Now I have another source reference, this time for something called <code class="language-plaintext highlighter-rouge">ask</code>?</p>

<p>SM: Sure, I have heard of it, here it is.</p>

<p>EE: Cool. Now in this functions local scope there is a target reference to <code class="language-plaintext highlighter-rouge">question</code>, have you heard of that?</p>

<p>SM: Yep, here it is.</p>

<p>EE: Awesome, now I have another source reference for <code class="language-plaintext highlighter-rouge">console</code>, (local scope) have you heard of it?</p>

<p>SM: Nope, let me go up a level (to global scope) and check.</p>

<p>EE: Have you (global scope) heard of <code class="language-plaintext highlighter-rouge">console</code>?</p>

<p>SM: Yes! You have access to any methods or properties on this object.</p>

<p>EE: But do you also have any knowledge of the source reference to something called <code class="language-plaintext highlighter-rouge">question</code>?</p>

<p>SM: Yep, here it is.</p>

<p>That completes the program. All of the above happens in a fraction of a millisecond, but it is important to understand how your JavaScript code is compiled and executed.</p>

<h3 id="compilation-review">Compilation Review</h3>

<p>Another review, like the last section, but this time walking through the following code:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">otherClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">topic</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">React</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Welcome!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">otherClass</span><span class="p">();</span> <span class="c1">// Welcome</span>

<span class="nx">teacher</span><span class="p">;</span> <span class="c1">// ??</span>
<span class="nx">topic</span><span class="p">;</span> <span class="c1">// ??</span></code></pre></figure>

<p>Try to walk through the code and have the conversion(s) of the two passes (compilation and execution) that JavaScript goes through.</p>

<h3 id="dynamic-global-variables">Dynamic Global Variables</h3>

<p>In the last section, you can see a variable <code class="language-plaintext highlighter-rouge">topic</code> that was never (formally) declared. What happens? Is there an error or not? (un)Fortunately(?), there is no error, but a new global variable <code class="language-plaintext highlighter-rouge">topic</code> is created for you. This is maybe a ‘bad’ thing, but it is in fact how JavaScript handles this undeclared variable. It comes from the early days of JavaScript when it was considered that people may forget to (formally) declare a variable, and instead of erroring out, one would be created. So forgiving!</p>

<p>But if you turn on ‘strict mode’, the ‘auto’ creation of an undeclared variable would behave differently.</p>

<h3 id="strict-mode">Strict Mode</h3>

<p>Turning on strict mode <code class="language-plaintext highlighter-rouge">"use strict"</code> would throw a ReferenceError for the undeclared variable in the previous section. Use strict mode! Most transpilers use strict mode for you. That’s nice. Using strict mode vs. not can introduce some different behaviors for how errors are handled, for example sometimes in non-strict mode errors will be handled silently, but if you use strict mode, you will get feedback for your errors.</p>

<h3 id="nested-scope">Nested Scope</h3>

<p>Now let’s look at some code with a nested scope:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">otherClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">Why?</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">otherClass</span><span class="p">();</span> <span class="c1">// Suzy Why?</span>
<span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">????</span><span class="dl">"</span><span class="p">);</span></code></pre></figure>

<p>The final line of the above code would throw a ReferenceError because <code class="language-plaintext highlighter-rouge">ask()</code> does not exist in the global scope and therefore cannot be located.</p>

<h3 id="undefined-vs-undeclared">Undefined vs Undeclared</h3>

<p>What is the difference between undefined and undeclared?</p>

<p>Undefined: A variable exists, but at the moment it has no value.</p>

<p>Undeclared: Never formally declared in any scope that we have access to.</p>

<h3 id="lexical-scope-elevator">Lexical Scope Elevator</h3>

<p>Imagine lexical scope as a building and current scope is the first floor of that building. If you do not find what you are looking for on the floor (scope) that you are on, keep going up until you either find it or not. Global scope is the top floor and if you do not find what you are looking for there, there is nowhere else to go.</p>

<h1>🏢</h1>

<h2 id="scope--function-expressions">Scope &amp; Function Expressions</h2>

<h3 id="function-expressions">Function Expressions</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">teacher</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* .. */</span> <span class="p">}</span>

<span class="kd">var</span> <span class="nx">myTeacher</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">anotherTeacher</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">anotherTeacher</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myTeacher</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">anotherTeacher</span><span class="p">);</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">myTeacher</code> is a function expression. Unlike a function declaration, which adds any declarations into its own scope, a function expression
will add declarations within its own scope, which is not the same scope as its identifier. i.e. <code class="language-plaintext highlighter-rouge">myTeacher</code> is in the global scope, but <code class="language-plaintext highlighter-rouge">anotherTeacher</code> is in its own scope, as is anything declared within it.</p>

<p>The final line <code class="language-plaintext highlighter-rouge">console.log(anotherTeacher);</code> will throw a ReferenceError because <code class="language-plaintext highlighter-rouge">anotherTeacher</code> is not declared in the global scope.</p>

<p>What is a named function expression? It is a function expression that has a name…</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">clickHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">keyHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">keyHandler</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">};</span></code></pre></figure>

<p>The first function above is an anonymous function expression, while the second function is an example of a named function expression. It is suggested that you should 💯% prefer the named function expression over the anonymous function expression, like always, forever, because…</p>

<h3 id="naming-function-expressions">Naming Function Expressions</h3>

<p>Here’s why you should always prefer named function expressions over anonymous function expressions:</p>

<ol>
  <li>
    <p>A named function expression creates a reliable self-reference to the function from inside of itself. Useful if you are going to make the function recursive, useful if the function is an event handler and needs to reference itself to unbind itself, useful if you need to access any properties on the function, such as; its length or its name. <strong>Any time</strong> you need to have a self-reference to a function, the only answer is that it needs to have a name.</p>
  </li>
  <li>
    <p>More debuggable stack traces. If you use a name for your function expression, it will show up in the stack trace.</p>
  </li>
  <li>
    <p>More self-documenting code. If you have an anonymous function, it is a lot harder to determine exactly where an error may be and you have to look between the code and console to make that determination. If you have a named function expression, the process is simplified simply because the name appears with your errors.</p>
  </li>
</ol>

<p>The purpose of code is not to make it as convenient as possible for you to type, but to communicate clearly your intent. The argument is made that it is likely more clear and simple to instead use function declarations over function expressions. The purpose of a function name is to tell you, “why does this thing exist?”.</p>

<h3 id="arrow-functions">Arrow Functions</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">ids</span> <span class="o">=</span> <span class="nx">people</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">person</span> <span class="o">=&gt;</span> <span class="nx">person</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ids</span> <span class="o">=</span> <span class="nx">people</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="nx">getId</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">person</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure>

<p>Arrow functions are anonymous. The instructor believes that you should not be using arrow functions as a replacement for all other functions. Named (arrow) function expressions? You would be saving characters (used) be just using a function declaration <em>and</em> making your code more readable. More concise code != more readable code</p>

<h3 id="function-types-hierarchy">Function Types Hierarchy</h3>

<p>Named Function Declaration &gt; Named Function Expression &gt; Anonymous Function Expression. This is not intended to be a hardline rule, you do have to look at the various use cases. But, they are organized in an order that provides a reader of you code with the most information to least.</p>

<h3 id="function-expression-exercise">Function Expression Exercise</h3>

<h4 id="function-expressions-1">Function Expressions</h4>

<p>In this exercise, you will be writing some functions and function expressions, to manage the student enrollment records for a workshop.</p>

<p><strong>Note:</strong> The spirit of this exercise is to use functions wherever possible and appropriate, so consider usage of array utilities <code class="language-plaintext highlighter-rouge">map(..)</code>, <code class="language-plaintext highlighter-rouge">filter(..)</code>, <code class="language-plaintext highlighter-rouge">find(..)</code>, <code class="language-plaintext highlighter-rouge">sort(..)</code>, and <code class="language-plaintext highlighter-rouge">forEach(..)</code>.</p>

<h4 id="instructions-part-1">Instructions (Part 1)</h4>

<p><strong>Note:</strong> In Part 1, use only function declarations or named function expressions.</p>

<p>You are provided three functions stubs – <code class="language-plaintext highlighter-rouge">printRecords(..)</code>, <code class="language-plaintext highlighter-rouge">paidStudentsToEnroll()</code>, and <code class="language-plaintext highlighter-rouge">remindUnpaid(..)</code> – which you must define.</p>

<p>At the bottom of the file you will see these functions called, and a code comment indicating what the console output should be.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">printRecords(..)</code> should:
    <ul>
      <li>take a list of student Ids</li>
      <li>retrieve each student record by its student Id (hint: array <code class="language-plaintext highlighter-rouge">find(..)</code>)</li>
      <li>sort by student name, ascending (hint: array <code class="language-plaintext highlighter-rouge">sort(..)</code>)</li>
      <li>print each record to the console, including <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">id</code>, and <code class="language-plaintext highlighter-rouge">"Paid"</code> or <code class="language-plaintext highlighter-rouge">"Not Paid"</code> based on their paid status</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">paidStudentsToEnroll()</code> should:
    <ul>
      <li>look through all the student records, checking to see which ones are paid but <strong>not yet enrolled</strong></li>
      <li>collect these student Ids</li>
      <li>return a new array including the previously enrolled student Ids as well as the to-be-enrolled student Ids (hint: spread <code class="language-plaintext highlighter-rouge">...</code>)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">remindUnpaid(..)</code> should:
    <ul>
      <li>take a list of student Ids</li>
      <li>filter this list of student Ids to only those whose records are in unpaid status</li>
      <li>pass the filtered list to <code class="language-plaintext highlighter-rouge">printRecords(..)</code> to print the unpaid reminders</li>
    </ul>
  </li>
</ol>

<h4 id="instructions-part-2">Instructions (Part 2)</h4>

<p>Now that you’ve completed Part 1, refactor to use <strong>only</strong> <code class="language-plaintext highlighter-rouge">=&gt;</code> arrow functions.</p>

<p>For <code class="language-plaintext highlighter-rouge">printRecords(..)</code>, <code class="language-plaintext highlighter-rouge">paidStudentsToEnroll()</code>, and <code class="language-plaintext highlighter-rouge">remindUnpaid(..)</code>, assign these arrow functions to variables of such names, so that the execution still works.</p>

<p>As the appeal of <code class="language-plaintext highlighter-rouge">=&gt;</code> arrow functions is their conciseness, wherever possible try to use only expression bodies (<code class="language-plaintext highlighter-rouge">x =&gt; x.id</code>) instead of full function bodies (<code class="language-plaintext highlighter-rouge">x =&gt; { return x.id; }</code>).</p>

<h3 id="function-expression-solution-functions">Function Expression Solution: Functions</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getStudentById</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentById</span><span class="p">);</span>

    <span class="nx">records</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span> <span class="nx">record2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span> <span class="p">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="nx">record1</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="nx">needsToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">currentEnrollments</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="nx">isUnpaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">getStudentById</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ********************************</span>

<span class="kd">var</span> <span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">664</span><span class="p">,</span> <span class="mi">375</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">studentRecords</span> <span class="o">=</span> <span class="p">[</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">313</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">410</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">709</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">502</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">664</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">375</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">867</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
<span class="p">];</span>

<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span></code></pre></figure>


</details>

<h3 id="function-expression-solution-arrow-functions">Function Expression Solution: Arrow Functions</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">getStudentById</span> <span class="o">=</span> <span class="nx">studentId</span> <span class="o">=&gt;</span>
    <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
        <span class="nx">record</span> <span class="o">=&gt;</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span>
    <span class="p">);</span>

<span class="kd">var</span> <span class="nx">printRecords</span> <span class="o">=</span> <span class="nx">recordIds</span> <span class="o">=&gt;</span>
    <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentById</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">sort</span><span class="p">(</span>
        <span class="p">(</span><span class="nx">record1</span><span class="p">,</span> <span class="nx">record2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span> <span class="p">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span>
        <span class="nx">record</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="p">);</span>

<span class="kd">var</span> <span class="nx">paidStudentsToEnroll</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">...</span><span class="nx">currentEnrollment</span><span class="p">,</span>
    <span class="p">...(</span>
        <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
            <span class="nx">record</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">record</span> <span class="o">=&gt;</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="kd">var</span> <span class="nx">remindUnpaid</span> <span class="o">=</span> <span class="nx">recordIds</span> <span class="o">=&gt;</span> 
    <span class="nx">printRecords</span><span class="p">(</span>
    <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
        <span class="nx">studentId</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">getStudentById</span><span class="p">(</span><span class="nx">studentId</span><span class="p">).</span><span class="nx">paid</span>
    <span class="p">))</span>

<span class="c1">// ********************************</span>

<span class="kd">var</span> <span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">664</span><span class="p">,</span> <span class="mi">375</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">studentRecords</span> <span class="o">=</span> <span class="p">[</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">313</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">410</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">709</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">502</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">664</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">375</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">867</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
<span class="p">];</span>

<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span></code></pre></figure>


</details>

<h2 id="advanced-scope">Advanced Scope</h2>

<h3 id="lexical--dynamic-scope">Lexical &amp; Dynamic Scope</h3>

<p>The idea of nested scope and that a compiler, parser, and processor is figuring out all the scope ahead of time before being executed, this is <strong>lexical scope</strong>. The vast majority of programming languages are lexically scoped.</p>

<p>Another model for scoping is dynamic scoping. Bash script is an example of a dynamically scoped language.</p>

<p>Lexical scope is fixed at author time and is not affected by run time conditions. Dynamic scoping, as the name implies, means that scope can be affected at run time.</p>

<h3 id="lexical-scope">Lexical Scope</h3>

<p>Lexical scope is popular because it can be optimized. When you are compiling code, defining variables and functions, etc, at run time there is no additional computation required. Conceptually, you can think of your programs scope as bubbles. There is a bubble around each function, and another around any nested functions, and one globally. You may be able to find a plugin that helps visualize your scopes as well! <code class="language-plaintext highlighter-rouge">vscode-levels</code></p>

<h3 id="dynamic-scope">Dynamic Scope</h3>

<p>In a dynamically scoped language (not JavaScript), the value assigned to a variable is dependent on where it was called from. Consider the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">otherClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>

    <span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">Why?</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">otherClass</span><span class="p">():</span></code></pre></figure>

<p>In the above code, what is the value of <code class="language-plaintext highlighter-rouge">teacher</code> in the <code class="language-plaintext highlighter-rouge">ask</code> function? In a lexically scoped language (JavaScript), the value of teacher would come from the global scope, because the <code class="language-plaintext highlighter-rouge">ask</code> function does not have any reference to the <code class="language-plaintext highlighter-rouge">teacher</code> variable, so the value of <code class="language-plaintext highlighter-rouge">teacher</code> would be <code class="language-plaintext highlighter-rouge">"Kyle"</code>. But in a dynamically scoped language (not JavaScript), the value of <code class="language-plaintext highlighter-rouge">teacher</code> would depend on where the <code class="language-plaintext highlighter-rouge">ask</code> function was called from, in this case <code class="language-plaintext highlighter-rouge">otherClass</code>. In <code class="language-plaintext highlighter-rouge">otherClass</code>, the value of <code class="language-plaintext highlighter-rouge">teacher</code> is <code class="language-plaintext highlighter-rouge">"Suzy"</code>, so in the <code class="language-plaintext highlighter-rouge">ask</code> function, <code class="language-plaintext highlighter-rouge">teacher</code> would return <code class="language-plaintext highlighter-rouge">"Suzy"</code>.</p>

<p>This can be quite flexible, but it is not how JavaScript works…</p>

<p>Dynamic Scope is determined by the conditions at run time. Even though JavaScript does not have dynamic scoping, there is a feature of the language that allows us to use this type of behavior which will be discussed in a later unit.</p>

<h3 id="function-scoping">Function Scoping</h3>

<p>How would you fix an issue where you want/need to have two variables have the same name without them colliding? Wrap at least one of them in a function! But now you have a new scope that still has a naming collision 😞. Enter <em>the principle of least exposure/privilege</em>! The principle states that you should default to keeping everything private and only exposing the minimal necessary. This essentially sets up a defensive posture and is one of the core principles of software engineering. It solves the following problems:</p>

<ol>
  <li>Name collisions</li>
  <li>It protects your things so that somebody else cannot accidentally or intentionally misuse that thing.</li>
  <li>Protect yourself for future refactoring.</li>
</ol>

<p>If you expose something, it’s almost a guarantee that someone is going to use it. As soon as someone uses it, you are restricting your ability to refactor it. Because if you refactor it, you are going to break someones code.</p>

<h3 id="iife-pattern">IIFE Pattern</h3>

<p>IIFE - Immediately Invoked Function Expression - Using a function expression to create a scope, immediately invoking it. If you are making an IIFE, there is likely some purpose for it and it should be named! Whether they are anonymous or not, IIFEs are just functions, which means that you can pass values into them. An interesting use case for an IIFE is a <code class="language-plaintext highlighter-rouge">try / catch</code>. If you are setting the value of a variable based on the result of a <code class="language-plaintext highlighter-rouge">try / catch</code> statement, it could be confusing to your reader… make it an IIFE!</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">getTeacher</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fetchTeacher</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">})();</span></code></pre></figure>

<p>IFFEs can be used any place that you need an expression, and any time you need a statement or scope in an expression.</p>

<h3 id="block-scoping">Block Scoping</h3>

<p>Block scoping is done with curly braces <code class="language-plaintext highlighter-rouge">{}</code>, instead of with functions. <code class="language-plaintext highlighter-rouge">let</code> and <code class="language-plaintext highlighter-rouge">const</code> exist so that you can make a declaration inside of a block and it turns that block into a scope. i.e.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="p">{</span>
    <span class="kd">let</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">);</span> <span class="c1">// Suzy</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">);</span> <span class="c1">// Kyle</span></code></pre></figure>

<p>Blocks are not scopes until they have a <code class="language-plaintext highlighter-rouge">let</code> or a <code class="language-plaintext highlighter-rouge">const</code> inside of them which implicitly makes them a scope. You should use <code class="language-plaintext highlighter-rouge">let</code> in places where it already makes sense for it to be used, inside of a block scope. <code class="language-plaintext highlighter-rouge">let</code> is a replacement for your already semantically signaled block scope(s).</p>

<p>Is <code class="language-plaintext highlighter-rouge">let</code> the new <code class="language-plaintext highlighter-rouge">var</code>? Nope. <code class="language-plaintext highlighter-rouge">let</code> is a new tool that we should add on to our existing usage and there are still reasons to use the <code class="language-plaintext highlighter-rouge">var</code> keyword.</p>

<h3 id="choosing-let-or-var">Choosing let or var</h3>

<p>Consider the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">repeat</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">(</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">i</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>In the above code, you <em>could</em> replace both <code class="language-plaintext highlighter-rouge">var</code>(s) with <code class="language-plaintext highlighter-rouge">let</code>, but the instructor suggests to only replace the <code class="language-plaintext highlighter-rouge">var</code> in the <code class="language-plaintext highlighter-rouge">for loop</code> with <code class="language-plaintext highlighter-rouge">let</code>. Here’s why: If you have a variable that belongs to the entire scope of the function, the correct and semantic way to signal that to your reader is not to use a <code class="language-plaintext highlighter-rouge">let</code> at the top level of your function scope, but to use a <code class="language-plaintext highlighter-rouge">var</code> because that is the thing it has always done for 24 years. Again, you could replace the initial <code class="language-plaintext highlighter-rouge">var</code> with <code class="language-plaintext highlighter-rouge">let</code>, it is recommended not to because doing so would remove a small amount of important semantic information from the reader, who may then not know your intent. <code class="language-plaintext highlighter-rouge">let</code> is supposed to signify a very localized usage of a variable, ideally within a couple lines of code.</p>

<p>If your code has something that is <em>naturally</em> block scoped, use <code class="language-plaintext highlighter-rouge">let</code>. Here’s an example of some code that would not work if you replaced <code class="language-plaintext highlighter-rouge">var</code> with <code class="language-plaintext highlighter-rouge">let</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">lookupRecord</span><span class="p">(</span><span class="nx">searchStr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">getRecord</span><span class="p">(</span><span class="nx">searchStr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">id</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>If the <code class="language-plaintext highlighter-rouge">var</code>(s) were replaced with <code class="language-plaintext highlighter-rouge">let</code>(s), the <code class="language-plaintext highlighter-rouge">let</code>(s) would be scoped to their blocks (<code class="language-plaintext highlighter-rouge">try / catch</code>) and would not be available for the <code class="language-plaintext highlighter-rouge">return</code> statement. 🤯</p>

<p><code class="language-plaintext highlighter-rouge">var</code> attaches itself to the function scope and is preferable in the above case because it is able to break out of the <em>unintended</em> block scope of the <code class="language-plaintext highlighter-rouge">try / catch</code>.</p>

<h3 id="explicit-let-block">Explicit let Block</h3>

<p>If you are going to use <code class="language-plaintext highlighter-rouge">let</code> for only a few lines of code and not again within the same function, it is recommended to put it in its own block scope. Like so:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">formatStr</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span> <span class="kd">let</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">rest</span><span class="p">;</span>
        <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
        <span class="nx">rest</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="mi">3</span> <span class="p">);</span>
        <span class="nx">str</span> <span class="o">=</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">rest</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="sr">/^FOO:/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">str</span> <span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="mi">4</span> <span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<h3 id="const">const</h3>

<p><code class="language-plaintext highlighter-rouge">const</code> is even better than <code class="language-plaintext highlighter-rouge">let</code>! But <code class="language-plaintext highlighter-rouge">const</code> does not carry its own weight in JavaScript. <code class="language-plaintext highlighter-rouge">const</code> is a variable that cannot be reassigned. <code class="language-plaintext highlighter-rouge">const</code> can be mutated! <code class="language-plaintext highlighter-rouge">const teachers = ["Me", "You"]; teachers[1] = "Someone Else";</code> There is baggage that comes with <code class="language-plaintext highlighter-rouge">const</code>. What the <code class="language-plaintext highlighter-rouge">const</code> keyword is actually supposed to inform is something along the lines of: For the rest of this [code] block, I am not going to be reassigned. The instructor will only use <code class="language-plaintext highlighter-rouge">const</code> with primitive values, which are immutable; strings, booleans, and numbers.</p>

<h3 id="const-qa">const Q&amp;A</h3>

<p>Q: If you only use <code class="language-plaintext highlighter-rouge">const</code> for strings, would that be a good use case?</p>

<p>A: Yes, I only use <code class="language-plaintext highlighter-rouge">const</code> for primitive, immutable values; strings, numbers, and booleans.</p>

<p>Q: With arrays or objects, I usually just put <code class="language-plaintext highlighter-rouge">freeze</code> or <code class="language-plaintext highlighter-rouge">deepfreeze</code> around it?</p>

<p>A: I do like to use <code class="language-plaintext highlighter-rouge">object.freeze</code> which is a shallow read-only lock of all the properties in an array or object.</p>

<h3 id="hoisting">Hoisting</h3>

<p>Until a couple of years ago, the word ‘hoisting’ literally did not appear in the JavaScript specification. Turns out, hoisting is not a real thing. The JavaScript engine does not hoist, it does not move things around the way it is suggested with hoisting. Hoisting is a made up [English] language convention to discuss the idea of lexical scope. Consider the following code:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">student</span><span class="p">;</span> <span class="c1">// ??</span>
<span class="nx">teacher</span><span class="p">;</span> <span class="c1">// ??</span>

<span class="kd">var</span> <span class="nx">student</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">You</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span></code></pre></figure>

<p>What will happen?! JavaScript will, in its first of two passes, parse the above code and create the variables, but without any value assigned to them, so both <code class="language-plaintext highlighter-rouge">student</code> and <code class="language-plaintext highlighter-rouge">teacher</code> would return <code class="language-plaintext highlighter-rouge">undefined</code>. <em>But</em>, the concept of hoisting does not mean that any actual code has been moved around. Functions hoist, they are taken at compile time and defined in such a way so they can be used earlier in the scope than when they’ve been declared.</p>

<h3 id="hoisting-example">Hoisting Example</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// var hoisting?</span>
<span class="c1">// usually bad :/</span>
<span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">teacher</span><span class="p">;</span>

<span class="c1">// function hoisting?</span>
<span class="c1">// Pretty useful :)</span>
<span class="nx">getTeacher</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getTeacher</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">teacher</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Unlike <code class="language-plaintext highlighter-rouge">var</code> hoisting, function hoisting can be useful. Do you usually put all of your function calls at the end of your files? How about putting them all at the top so you can immediately see them?! You can!</p>

<h3 id="let-doesnt-hoist">let Doesn’t Hoist</h3>

<p><code class="language-plaintext highlighter-rouge">let</code> doesn’t hoist is not true… <code class="language-plaintext highlighter-rouge">let</code> and <code class="language-plaintext highlighter-rouge">const</code> hoist, but not in the same way as <code class="language-plaintext highlighter-rouge">var</code> or functions. A <code class="language-plaintext highlighter-rouge">var</code> will initialize to <code class="language-plaintext highlighter-rouge">undefined</code>, but a <code class="language-plaintext highlighter-rouge">let</code> or <code class="language-plaintext highlighter-rouge">const</code> will not be initialized. <code class="language-plaintext highlighter-rouge">let</code> or <code class="language-plaintext highlighter-rouge">const</code> will hoist, but will throw a temporal dead zone [TDZ] error. But why TDZ? TDZ exists because of <code class="language-plaintext highlighter-rouge">const</code>. Imagine <code class="language-plaintext highlighter-rouge">const</code> being attached inside of a block scope. And also imagine if <code class="language-plaintext highlighter-rouge">const</code> initialized itself to <code class="language-plaintext highlighter-rouge">undefined</code>. Then you <code class="language-plaintext highlighter-rouge">console.log</code> that <code class="language-plaintext highlighter-rouge">const</code> and it returns undefined, then later it returned the actual value that was assigned to it, now your <code class="language-plaintext highlighter-rouge">const</code> <em>can</em> have two different values assigned to it? This <em>academically</em> violates the concept of <code class="language-plaintext highlighter-rouge">const</code>. So they make the TDZ and also assign this behavior to <code class="language-plaintext highlighter-rouge">let</code>.</p>

<p>It is advised that you declare all <code class="language-plaintext highlighter-rouge">let</code> or <code class="language-plaintext highlighter-rouge">const</code> on the very first line of your blocks to avoid TDZ errors.</p>

<p>Q: Why do function expressions not hoist?</p>

<p>A: When you assign a function expression to a variable, the variable’s declaration itself hoisted, but the assignment only comes at run time.</p>

<h3 id="hoisting-exercise">Hoisting Exercise</h3>

<h4 id="hoisting-1">Hoisting</h4>

<p>In this exercise, you will refactor some code that manages student enrollment records for a workshop, to take advantage of function hoisting.</p>

<h4 id="instructions-1">Instructions</h4>

<p>Refactor all inline function expressions to be function declarations. Place function declarations at the bottom (that is, below any executable code) of their respective scopes.</p>

<p>Also, pull function declarations to outer scopes if they don’t need to be nested.</p>

<h3 id="hoisting-exercise-solution">Hoisting Exercise Solution</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">664</span><span class="p">,</span> <span class="mi">375</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">studentRecords</span> <span class="o">=</span> <span class="p">[</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">313</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">410</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">709</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">502</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">664</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">375</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">867</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
<span class="p">];</span>

<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span>

<span class="c1">// ********************************</span>

<span class="kd">function</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">matchId</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">){</span>
		<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentFromId</span><span class="p">);</span>
    
    <span class="nx">record</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortByNameAsc</span><span class="p">);</span>
    <span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">printRecord</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span><span class="nx">record2</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">recordsToEnroll</span> <span class="o">=</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">needToEnroll</span><span class="p">);</span>

	<span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">recordsToEnroll</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentId</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">needToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">){</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">notYetPaid</span><span class="p">);</span>

	<span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">notYetPaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>


</details>

<p>The purpose of this exercise is to flatten the scope of the program, which makes it [scope] easier to manage. Additionally, this can make your code more readable, which makes it easier for both your future self or another developer to dig in and work with your code.</p>

<h2 id="closure">Closure</h2>

<h3 id="origin-of-closure">Origin of Closure</h3>

<p>Closure, according to the instructor, is one of the most important ideas ever invented in computer science. The instructor goes on to tell the story of the developer of JavaScript and how pervasive closure is across all development languages yet most developers do not know how to define it. Closure predates computer science, coming from lambda calculus. To understand closure, you have to understand lexical scope.</p>

<h3 id="what-is-closure">What is Closure?</h3>

<p>Closure is when a function is able to “remember” and access its lexical scope, the variables outside of itself, even when the function is executed outside of that lexical scope. The first part, a function is able to access variables outside of itself, is lexical scope; if <code class="language-plaintext highlighter-rouge">teacher</code> is not defined in <em>my</em> scope, is it in the ‘next-level-up’ scope? And so on, until it finds <code class="language-plaintext highlighter-rouge">teacher</code> or not. But without the second part, even when the function is executed outside of that lexical scope, is what makes closure… closure. The preservation, or linkage, back to the original scope where a function was defined, no matter where it is passed, it retains its value and retains its scope, that is closure.</p>

<p>Here is an example of closure:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="nx">waitASec</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">question</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">What is closure?</span><span class="dl">"</span><span class="p">);</span></code></pre></figure>

<h3 id="closing-over-variables">Closing Over Variables</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">myTeacher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">myTeacher</span><span class="p">();</span> <span class="c1">// ??</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">myTeacher();</code> would return <code class="language-plaintext highlighter-rouge">Suzy</code>. Closure is not capturing values, but preserving access to variables. One cannot effectively use closure until you get away from the perception that closure captures values. Consider the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`i: </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">},</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// i: 4</span>
<span class="c1">// i: 4</span>
<span class="c1">// i: 4</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">i</code> would only return <code class="language-plaintext highlighter-rouge">4</code> because we need another variable, or variables, to store the various ‘states’ that <code class="language-plaintext highlighter-rouge">i</code> would be through its iteration. One way to ‘solve’ this would be to declare a new variable and assign it to the value of <code class="language-plaintext highlighter-rouge">i</code>. i.e.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>

    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`j: </span><span class="p">${</span><span class="nx">j</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">},</span> <span class="nx">j</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// j: 1</span>
<span class="c1">// j: 2</span>
<span class="c1">// j: 3</span></code></pre></figure>

<p>For each iteration, <code class="language-plaintext highlighter-rouge">j</code> will be ‘updated’ with the ‘new’ value of <code class="language-plaintext highlighter-rouge">i</code>, so the console will log the expected values of 1,2,3. An arguably better / more concise approach would be to do the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`i: </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">},</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// i: 1</span>
<span class="c1">// i: 2</span>
<span class="c1">// i: 3</span></code></pre></figure>

<p>Using <code class="language-plaintext highlighter-rouge">let</code> also produces the expected result because <code class="language-plaintext highlighter-rouge">let</code> creates a new <code class="language-plaintext highlighter-rouge">i</code> for each iteration. This is new behavior as of ES6. The point is if you need to close over different variables, then you need the different variables, not try to capture different values.</p>

<p>Q: The <code class="language-plaintext highlighter-rouge">i</code> declared in the <code class="language-plaintext highlighter-rouge">for loop</code> is interpreted as a new variable for each iteration?</p>

<p>A: Yes, it [the <code class="language-plaintext highlighter-rouge">i</code>] is interpreted as if each iteration there is a new declaration of <code class="language-plaintext highlighter-rouge">i</code> and JavaScript takes care of assigning it the value that it at the end of the previous iteration. All  <code class="language-plaintext highlighter-rouge">for loop</code>(s) have this type of <code class="language-plaintext highlighter-rouge">let</code> variance. <code class="language-plaintext highlighter-rouge">for of</code>, <code class="language-plaintext highlighter-rouge">for in</code>, and <code class="language-plaintext highlighter-rouge">for</code> loops have this.</p>

<p>In summary, closure is a preservation of the linkage to a variable, not the capturing of that value.</p>

<h3 id="module-pattern">Module Pattern</h3>

<p>Now that we understand lexical scope and closure, we can look at the module pattern. First let’s look at what is not a module, like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">Is this a module?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle Is this a module?</span></code></pre></figure>

<p>The above code is not a module, it <em>is</em> what could be called a ‘namespace’. Not really a syntactic feature of the [JavaScript] language, but it’s an idiom that we make namespaces with objects. While there is nothing wrong with writing your code in this way, it is definitely not a module. The reason being is that the module pattern requires the concept of encapsulation. Encapsulation is to hide data and behavior. The idea of a module is that there are things that are ‘public’, that’s your public API, and there are things that are private, things that nobody on the outside can touch. If you want to have a module, you need to have encapsulation (data hiding).</p>

<p>The ‘classic’ module pattern, sometimes referred to as the revealing module pattern, encapsulates data and it does so with closure. You can’t have a module if you don’t have closure. Here is an example of what a module <em>does</em> look like:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">Module</span><span class="p">(</span><span class="nx">teacher</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">publicAPI</span> <span class="o">=</span> <span class="p">{</span><span class="nx">ask</span><span class="p">,</span> <span class="p">};</span>
    <span class="k">return</span> <span class="nx">publicAPI</span><span class="p">;</span>
    
    <span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">})(</span><span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">It's a module, right?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle It's a module, right?</span></code></pre></figure>

<p>The above module has two components to it.</p>

<ol>
  <li>
    <p>An outer enclosing function. In this case, the outer enclosing function is an IIFE. When you run a module as an IIFE, it is kind of similar to a Singleton. Because IIFEs run once and then they are done. But it’s not really <em>done</em> because the closure prevents its scope from going away.</p>
  </li>
  <li>
    <p>The second component of the module is the inner function, which is closed over two variables <code class="language-plaintext highlighter-rouge">teacher</code> and <code class="language-plaintext highlighter-rouge">question</code>. Since it is closed over the <code class="language-plaintext highlighter-rouge">teacher</code> variable, the <code class="language-plaintext highlighter-rouge">workshop</code> object on the outside, which has reference to the <code class="language-plaintext highlighter-rouge">ask</code> function, preserves the inner scope through closure.</p>
  </li>
</ol>

<p>The module pattern keeps private state private and exposes things on an object, as you can see in the <code class="language-plaintext highlighter-rouge">publicAPI</code> object, where <code class="language-plaintext highlighter-rouge">ask</code> is exposed. This usage of closure is actually closing over variables that are designed to change state over time. That’s the whole purpose of a module, to track state over time. You could go so far as to say that if you have something that you are calling a module but it does not track state in any way, it is not really a module.</p>

<p>Here is an example of a module in a factory function style:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">WorkshopModule</span><span class="p">(</span><span class="nx">teacher</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">publicAPI</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">ask</span><span class="p">,</span> <span class="p">};</span>
    <span class="k">return</span> <span class="nx">publicAPI</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">workshop</span> <span class="o">=</span> <span class="nx">WorkshopModule</span><span class="p">(</span><span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">It's a module, right?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle It's a module, right?</span></code></pre></figure>

<p>With the Module Factory pattern, you can create as many instances of the module and they will all have their own state. The module pattern is arguable the most prevalent and important of all code organization patterns. ~80-90% of all JavaScript that’s ever been written has used some mechanism like the module pattern as it’s code organization pattern. But, the module pattern in JavaScript is more of a syntactic hack in that it is not exactly a language feature or first-class citizen, but rather a methodology of using the tools in a way that accomplishes some end goal.</p>

<h3 id="es6-modules--nodejs">ES6 Modules &amp; Node.js</h3>

<p>Because the module pattern is actually not a part of JavaScript, and many wanted them to be, modules eventually found their way to the language in ES6. In the current implementation, they are still very much a WIP. The issue being that TC39 and Node.js did not communicate about how modules would be implemented at first. There have been some conversations about how to fix this, but where its landed is that to use modules in Node, you have to use a new file extension name; <code class="language-plaintext highlighter-rouge">.mjs</code>. There is a working group within Node that is trying to get full support for modules, which they will implement in phases. And at the time of writing this, Node should have pushed phase 1 of 4 of module support in Node. The ES6 module pattern looks like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">teacher</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
<span class="p">};</span></code></pre></figure>

<p>Because the above is a module, it is assumed that everything is private. The way you make something public is by using the <code class="language-plaintext highlighter-rouge">export</code> keyword, everything you do not export will be private. In ES6, modules are file-based. Which means it is impossible to have more than one ES6 module in the same file. Which means that for each module your application needs, you need to have a separate file for it. This can grow quickly. And since you have to compile everything back to the module format we’ve previously covered anyway, wouldn’t it make sense to just write your modules in that format and skip the compilation step?</p>

<h3 id="es6-module-syntax">ES6 Module Syntax</h3>

<p>To import modules into your files, there are two major styles used:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="nx">ask</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">workshop.mjs</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">It's a default import, right?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle It's a default import, right?</span>

<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">workshop</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">workshop.mjs</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">It's a namespace import, right?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle It's a namespace import, right?</span></code></pre></figure>

<p>The first import is known as a <code class="language-plaintext highlighter-rouge">named import</code>, the second style is known as a <code class="language-plaintext highlighter-rouge">namespace import</code> which is effectively collecting all (*) of the exports and placing them in the namespace of <code class="language-plaintext highlighter-rouge">workshop</code>. The <code class="language-plaintext highlighter-rouge">namespace import</code> is more similar to how modules have been done in JavaScript over the last 20 years, whereas the <code class="language-plaintext highlighter-rouge">named import</code> style is more of a new school thinking. Neither is right or wrong, but comes down to how you prefer to work with your modules.</p>

<p>Whichever way you choose to implement your modules, the same underlying structure / purpose applies. You are organizing a set of behavior into a cohesive unit, hiding data in it and exposing a minimal necessary API. The module pattern is one of the three core pillars of JavaScript and touches everything else in a foundational way.</p>

<h3 id="module-exercise">Module Exercise</h3>

<h4 id="modules">Modules</h4>

<p>In this exercise, you will refactor some code that manages student enrollment records for a workshop, to use the module pattern.</p>

<h4 id="instructions-2">Instructions</h4>

<ol>
  <li>
    <p>Wrap all of the functions in a module factory (ie, function named <code class="language-plaintext highlighter-rouge">defineWorkshop()</code>). This function should make a return a public API object.</p>
  </li>
  <li>
    <p>The returned public API object should include the following methods:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">addStudent(id,name,paid)</code></li>
      <li><code class="language-plaintext highlighter-rouge">enrollStudent(id)</code></li>
      <li><code class="language-plaintext highlighter-rouge">printCurrentEnrollment()</code></li>
      <li><code class="language-plaintext highlighter-rouge">enrollPaidStudents()</code></li>
      <li><code class="language-plaintext highlighter-rouge">remindUnpaidStudents()</code>,</li>
    </ul>
  </li>
  <li>
    <p>Move the <code class="language-plaintext highlighter-rouge">currentEnrollment</code> and <code class="language-plaintext highlighter-rouge">studentRecords</code> arrays inside the module definition, but as empty arrays.</p>
  </li>
  <li>
    <p>Create an instance of this module by calling <code class="language-plaintext highlighter-rouge">defineWorkshop()</code>, and name it <code class="language-plaintext highlighter-rouge">deepJS</code>.</p>
  </li>
  <li>
    <p>Define all the student records by calling <code class="language-plaintext highlighter-rouge">deepJS.addStudent(..)</code> for each.</p>
  </li>
  <li>
    <p>Define the student enrollments by calling <code class="language-plaintext highlighter-rouge">deepJS.enrollStudent(..)</code> for each.</p>
  </li>
  <li>
    <p>Change the execution code (the console output steps) to references to <code class="language-plaintext highlighter-rouge">deepJS.*</code> public API methods.</p>
  </li>
</ol>

<details>
    <summary>Work from this code
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">664</span><span class="p">,</span> <span class="mi">375</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">studentRecords</span> <span class="o">=</span> <span class="p">[</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">313</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">410</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">709</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">502</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">664</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">375</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">867</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span> <span class="na">paid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="p">},</span>
<span class="p">];</span>

<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span>


<span class="c1">// ********************************</span>

<span class="kd">function</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">matchId</span><span class="p">);</span>

	<span class="c1">// *************************</span>

	<span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentFromId</span><span class="p">);</span>

	<span class="nx">records</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortByNameAsc</span><span class="p">);</span>

	<span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">printRecord</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span><span class="nx">record2</span><span class="p">){</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">recordsToEnroll</span> <span class="o">=</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">needToEnroll</span><span class="p">);</span>

	<span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">recordsToEnroll</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentId</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">needToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">notYetPaid</span><span class="p">);</span>

	<span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">notYetPaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>


</details>

<h3 id="module-exercise-solution">Module Exercise Solution</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">deepJS</span> <span class="o">=</span> <span class="nx">defineWorkshop</span><span class="p">();</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">313</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">709</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">502</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">867</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollPaidStudents</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">remindUnpaidStudents</span><span class="p">();</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span>


<span class="c1">// ********************************</span>

<span class="kd">function</span> <span class="nx">defineWorkshop</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">studentRecords</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">publicAPI</span> <span class="o">=</span> <span class="p">{</span> 
        <span class="nx">addStudent</span><span class="p">,</span>
        <span class="nx">enrollStudent</span><span class="p">,</span>
        <span class="nx">printCurrentEnrollment</span><span class="p">,</span>
        <span class="nx">enrollPaidStudents</span><span class="p">,</span>
        <span class="nx">remindUnpaidStudents</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">publicAPI</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">addStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">paid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">paid</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">enrollStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">printCurrentEnrollment</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">enrollPaidStudents</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
        <span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">remindUnpaidStudents</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// *************************</span>

    <span class="kd">function</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">matchId</span><span class="p">);</span>

	    <span class="c1">// *************************</span>

        <span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentFromId</span><span class="p">);</span>

        <span class="nx">records</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortByNameAsc</span><span class="p">);</span>

        <span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">printRecord</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span><span class="nx">record2</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">recordsToEnroll</span> <span class="o">=</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">needToEnroll</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">recordsToEnroll</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentId</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">needToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">notYetPaid</span><span class="p">);</span>

        <span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">notYetPaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>


</details>

<p>Modules are pretty important in JavaScript, maybe even in all of software development. You will get a lot of mileage out of thinking in this pattern, practicing it, trying to implement it more. Try to find opportunities to implement the module pattern!</p>

<h2 id="objects">Objects</h2>

<h3 id="objects-overview">Objects Overview</h3>

<p>Another of the ‘three core pillars’ of JavaScript that is important to understand is the ‘Objects’ Oriented system. Objects, <code class="language-plaintext highlighter-rouge">this</code>, and Prototypes make up the objects oriented system. Objects oriented instead of object oriented because JavaScript is not strictly a class system, there are classes that have been layered on top of it.</p>

<h3 id="the-this-keyword">The this Keyword</h3>

<p>Arguably the most confused of all the JavaScript features, the <code class="language-plaintext highlighter-rouge">this</code> keyword. If you are coming to JavaScript from another language that uses the <code class="language-plaintext highlighter-rouge">this</code> keyword, you may have had some difficulty understanding how <code class="language-plaintext highlighter-rouge">this</code> was implemented in JavaScript.</p>

<p>A function’s <code class="language-plaintext highlighter-rouge">this</code> references the execution context for that call, determined entirely by how the function was called. In other words, if you look at a function that has the <code class="language-plaintext highlighter-rouge">this</code> keyword in it, it is defined by how the function was called. This is counterintuitive because most people think you could look at a function and figure out what its <code class="language-plaintext highlighter-rouge">this</code> keyword is going to point out. But the definition of the function does not  matter at all, to determining the <code class="language-plaintext highlighter-rouge">this</code> keyword. The only thing that matters is how the function was invoked.</p>

<p>A <code class="language-plaintext highlighter-rouge">this</code>-aware function can have a different context each time it is called, which makes it more flexible and reusable. Here is an example of the dynamic flexibility of the <code class="language-plaintext highlighter-rouge">this</code> keyword in action:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">otherClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myContext</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span>
    <span class="p">};</span>
    <span class="nx">ask</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">myContext</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Why?</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">otherClass</span><span class="p">();</span></code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">this</code> keyword exists so we can invoke functions in different contexts. There are four different ways to invoke a function. Each of the four ways to call a function in JavaScript will define what is the <code class="language-plaintext highlighter-rouge">this</code> keyword differently.</p>

<h3 id="implicit--explicit-binding">Implicit &amp; Explicit Binding</h3>

<p>The first of the four methods to invoke a function we’ll cover is implicit binding.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">What is implicit binding?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle What is implicit binding?</span></code></pre></figure>

<p>Revisiting the namespace pattern, how does the <code class="language-plaintext highlighter-rouge">this</code> keyword behave inside of this pattern? When <code class="language-plaintext highlighter-rouge">ask</code> function is invoked, how do you know what the <code class="language-plaintext highlighter-rouge">this</code> keyword will point at? Because of the ‘call site’ (workshop), the <code class="language-plaintext highlighter-rouge">this</code> keyword will point at the <code class="language-plaintext highlighter-rouge">workshop</code> object. This is exactly how the <code class="language-plaintext highlighter-rouge">this</code> binding works in other languages. This is the most intuitive form of the <code class="language-plaintext highlighter-rouge">this</code> keyword because it decides the method based upon what object you call it from. The idea of having implicit binding is useful because this is how we share behavior among different contexts. Here is another example of implicit binding where the <code class="language-plaintext highlighter-rouge">ask</code> function is being used more than once and has two different <code class="language-plaintext highlighter-rouge">this</code> contexts:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">workshop1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">ask</span><span class="p">:</span> <span class="nx">ask</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">workshop2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">ask</span><span class="p">:</span> <span class="nx">ask</span><span class="p">,</span>
<span class="p">};</span>

<span class="nx">workshop1</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">How do I share a method?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle How do I share a method?</span>

<span class="nx">workshop2</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">How do I share a method?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Suzy How do I share a method?</span></code></pre></figure>

<p>In the above code, you can see that the <code class="language-plaintext highlighter-rouge">ask</code> function is being assigned to different contexts (<code class="language-plaintext highlighter-rouge">workshop1</code> <code class="language-plaintext highlighter-rouge">workshop2</code>) and because of this, the <code class="language-plaintext highlighter-rouge">this</code> keyword will point at the respective objects that it was called from. Another method to invoke functions which we’ve seen before is the <code class="language-plaintext highlighter-rouge">.call</code> method. Along with the <code class="language-plaintext highlighter-rouge">.apply</code> method, the <code class="language-plaintext highlighter-rouge">.call</code> method takes, as their first argument, a <code class="language-plaintext highlighter-rouge">this</code> keyword.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">workshop1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">workshop2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">ask</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">workshop1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Can I explicitly set context?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle Can I explicitly set context?</span>

<span class="nx">ask</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">workshop2</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Can I explicitly set context?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Suzy Can I explicitly set context?</span></code></pre></figure>

<p>Above, on the first <code class="language-plaintext highlighter-rouge">ask.call</code>, when you pass in <code class="language-plaintext highlighter-rouge">workshop1</code>, it is saying invoke the <code class="language-plaintext highlighter-rouge">ask</code> function with the <code class="language-plaintext highlighter-rouge">this</code> context of <code class="language-plaintext highlighter-rouge">workshop1</code>. It is similar to the implicit binding example at the beginning of this section, the function is still being shared, but it is now being done explicitly rather than implicitly. We are saying, wherever this function comes from, invoke it in this particular context, which I am going to specify. <code class="language-plaintext highlighter-rouge">.call</code> and <code class="language-plaintext highlighter-rouge">.apply</code> can be used to explicitly tell JavaScript what context to invoke a function in.</p>

<p>A variation of explicit binding is called hard binding, which looks like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Lost this?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// undefined Lost this?</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">workshop</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Hard bound this?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle Hard bound this?</span></code></pre></figure>

<p>The first <code class="language-plaintext highlighter-rouge">setTimeout</code> above is not the call site for <code class="language-plaintext highlighter-rouge">workshop.ask</code>, so the binding is lost and bound to the global object in this case. A common solution to this can be seen on the second <code class="language-plaintext highlighter-rouge">setTimeout</code> which hard binds the <code class="language-plaintext highlighter-rouge">workshop.ask</code> function to the <code class="language-plaintext highlighter-rouge">workshop</code> object. <em>If</em> you use <code class="language-plaintext highlighter-rouge">.bind</code> to hard bind the <code class="language-plaintext highlighter-rouge">this</code> to a particular scope, you are effectively removing the flexibility of the <code class="language-plaintext highlighter-rouge">this</code> keyword, which is not the intended purpose of the <code class="language-plaintext highlighter-rouge">this</code> keyword. If you do not need the flexibility, you may be better off refactoring your code to a module pattern which provides a fixed, predictable behavior.</p>

<p>If you are only occasionally using hard binding when setting up a <code class="language-plaintext highlighter-rouge">this</code> aware function, you are probably getting enough benefit out of your code as it is written and do not need to refactor it. If you are frequently using hard binding when setting up a <code class="language-plaintext highlighter-rouge">this</code> aware function, you should probably refactor your code. If you want flexible dynamism, use a <code class="language-plaintext highlighter-rouge">this</code> keyword, if you want predictability, use closures, use lexical scope.</p>

<h3 id="the-new-keyword">The new Keyword</h3>

<p>The third way to invoke a function is the <code class="language-plaintext highlighter-rouge">new</code> keyword, which may seem like we are invoking a ‘class constructor’, but it is really just an unfortunate syntactic trick to make it look like it is dealing with classes when it really isn’t. The <code class="language-plaintext highlighter-rouge">new</code> keyword does four very specific things when invoking a function and the purpose of the <code class="language-plaintext highlighter-rouge">new</code> keyword is to invoke a function with a <code class="language-plaintext highlighter-rouge">this</code> keyword that points to a whole new empty object. You could get the same behavior if you used <code class="language-plaintext highlighter-rouge">.call()</code>, which would also invoke a function with a <code class="language-plaintext highlighter-rouge">this</code> keyword that points to a whole new empty object, the only difference is the ‘syntactic sugar’ that the <code class="language-plaintext highlighter-rouge">new</code> keyword provides. Here are the four things that the <code class="language-plaintext highlighter-rouge">new</code> keyword does when it is used to invoke a function:</p>

<ol>
  <li>
    <p>Create a brand new empty object.</p>
  </li>
  <li>
    <ul>
      <li>Link that object to another object.</li>
    </ul>
  </li>
  <li>
    <p>Calls the function with <code class="language-plaintext highlighter-rouge">this</code> pointing to the new object.</p>
  </li>
  <li>If the function does not return an object, the <code class="language-plaintext highlighter-rouge">new</code> keyword assumes that <code class="language-plaintext highlighter-rouge">this</code> should be returned.</li>
</ol>

<p>If you put <code class="language-plaintext highlighter-rouge">new</code> in front of any function, even an empty one, all four of the things will happen.</p>

<h3 id="default-binding">Default Binding</h3>

<p>The final way of invoking a function is with default binding, which looks like this <code class="language-plaintext highlighter-rouge">functionName(argument);</code>. If your program is in ‘strict mode’, and <code class="language-plaintext highlighter-rouge">this</code> has no explicit binding, <code class="language-plaintext highlighter-rouge">this</code> will be undefined and calling a function that refers to <code class="language-plaintext highlighter-rouge">this</code> will throw a TypeError, because in ‘strict mode’ <code class="language-plaintext highlighter-rouge">this</code> needs to be explicitly defined. The reason being, that if you have created a <code class="language-plaintext highlighter-rouge">this</code> aware function, there is no reason that <code class="language-plaintext highlighter-rouge">this</code> should not be defined. Define <code class="language-plaintext highlighter-rouge">this</code> in strict mode! Use one of the other three methods to invoke a function; <code class="language-plaintext highlighter-rouge">new</code> keyword, <code class="language-plaintext highlighter-rouge">.call</code>, <code class="language-plaintext highlighter-rouge">.apply</code>, or <code class="language-plaintext highlighter-rouge">.bind</code>, or a context object, i.e. <code class="language-plaintext highlighter-rouge">workshop.ask()</code></p>

<h3 id="binding-precedence">Binding Precedence</h3>

<p>What if you had a [function] call site like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">;</span>
    <span class="nl">ask</span><span class="p">:</span> <span class="kd">function</span> <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="k">new</span> <span class="p">(</span><span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">workshop</span><span class="p">))(</span><span class="dl">"</span><span class="s2">What does this do?</span><span class="dl">"</span><span class="p">);</span></code></pre></figure>

<p>In the above code, the function <code class="language-plaintext highlighter-rouge">ask</code> is being called with <code class="language-plaintext highlighter-rouge">new</code>, a context object, <code class="language-plaintext highlighter-rouge">.bind</code>, that’s three of the ways to invoke a function being used at once. This is not a useful thing to do, but let’s look at how it works and which of the function invoke(rs?) takes precedence. The order of binding precedence is as follows:</p>

<ol>
  <li>
    <p>Is the function called by <code class="language-plaintext highlighter-rouge">new</code>? If so, the newly created object will be the <code class="language-plaintext highlighter-rouge">this</code> keyword.</p>
  </li>
  <li>
    <p>Is the function called by <code class="language-plaintext highlighter-rouge">.call</code> or <code class="language-plaintext highlighter-rouge">.apply</code> (<code class="language-plaintext highlighter-rouge">.bind</code> uses <code class="language-plaintext highlighter-rouge">.apply</code>)? If so, the context object that is specified will be used.</p>
  </li>
  <li>
    <p>Is the function called on a context object? If so, use that object.</p>
  </li>
  <li>
    <p>DEFAULT: Global object (except strict mode).</p>
  </li>
</ol>

<h3 id="arrow-functions--lexical-this">Arrow Functions &amp; Lexical this</h3>

<p>But what about arrow functions and the <code class="language-plaintext highlighter-rouge">this</code> keyword?! Lexical <code class="language-plaintext highlighter-rouge">this</code> occurs. But what is lexical <code class="language-plaintext highlighter-rouge">this</code>? An arrow functions <code class="language-plaintext highlighter-rouge">this</code> is not hardbound to its parents <code class="language-plaintext highlighter-rouge">this</code>, the correct way to think about what an arrow function does is; An arrow function does not define a <code class="language-plaintext highlighter-rouge">this</code> keyword at all. So if you put a <code class="language-plaintext highlighter-rouge">this</code> keyword inside of an arrow function, it will behave just like every other variable, which in this case means that it will resolve itself to a scope that does define a <code class="language-plaintext highlighter-rouge">this</code> keyword. The [JavaScript] spec states: An arrow function does not define local bindings for arguments, super, this, or new.target. Any reference to arguments, super, this, or new.target within an arrow function must resolve to a binding in a lexically enclosing environment.</p>

<h3 id="resolving-this-in-arrow-functions">Resolving this in Arrow Functions</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">workshop</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">teacher</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">ask</span><span class="p">:</span> <span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">What happened to 'this'?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// undefined What happened to 'this'?</span>

<span class="nx">workshop</span><span class="p">.</span><span class="nx">ask</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">workshop</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Still no 'this'?:</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// undefined Still no 'this'?</span></code></pre></figure>

<p>Ummm… why is <code class="language-plaintext highlighter-rouge">this</code> returning undefined? Well, what is the parent scope for the <code class="language-plaintext highlighter-rouge">ask</code> function in the above code? Did you guess global? If you did, that is correct; the <code class="language-plaintext highlighter-rouge">workshop</code> object is not a scope, it is an object, so the <code class="language-plaintext highlighter-rouge">ask</code> function would look in the global scope for <code class="language-plaintext highlighter-rouge">this</code>, which in this case is in fact undefined. 😞</p>

<p>It is recommended that the <em>only</em> time you should use an arrow function is when you will benefit from the lexical <code class="language-plaintext highlighter-rouge">this</code> behavior. The only alternative is a <em>hack</em> such as <code class="language-plaintext highlighter-rouge">var self = this;</code>. Which is not a good alternative because the <code class="language-plaintext highlighter-rouge">this</code> keyword never points at a function but at a context, so if you absolutely must do the <code class="language-plaintext highlighter-rouge">var self = this;</code> hack, it is probably better to write it as <code class="language-plaintext highlighter-rouge">var context = this;</code>. (Preference of the instructor, may help readability) But really, the purpose, or function, of the arrow function should be to adopt the <code class="language-plaintext highlighter-rouge">this</code> of a parent scope.</p>

<p><strong>Only use =&gt; arrow functions when you need lexical this.</strong></p>

<p>If you are going to use an arrow function to have access to lexical <code class="language-plaintext highlighter-rouge">this</code>, you need to combat the following three issues with using an anonymous function:</p>

<ol>
  <li>
    <p>Anonymous functions don’t have a self-reference - In case you need to do recursion or binding.</p>
  </li>
  <li>
    <p>Anonymous functions don’t have a name - Assign it to a variable or a property so that it gets a name inference.</p>
  </li>
  <li>
    <p>Anonymous functions don’t have readily obvious reasons for their existence - Somehow, make it clear to the reader what your function’s purpose is.</p>
  </li>
</ol>

<h3 id="this-exercise">this Exercise</h3>

<h4 id="this"><code class="language-plaintext highlighter-rouge">this</code></h4>

<p>In this exercise, you will refactor some code that manages student enrollment records for a workshop, from the module pattern to the namespace pattern using the <code class="language-plaintext highlighter-rouge">this</code> keyword.</p>

<h4 id="instructions-3">Instructions</h4>

<ol>
  <li>
    <p>Remove the <code class="language-plaintext highlighter-rouge">defineWorkshop()</code> module factory, and replace it with an object literal (named <code class="language-plaintext highlighter-rouge">deepJS</code>) that holds all the module’s functions, as well as the <code class="language-plaintext highlighter-rouge">currentEnrollment</code> and <code class="language-plaintext highlighter-rouge">studentRecords</code> data arrays.</p>
  </li>
  <li>
    <p>Change all internal function references and references to the data  arrays to use the <code class="language-plaintext highlighter-rouge">this</code> keyword prefix.</p>
  </li>
  <li>
    <p>Make sure any place where a <code class="language-plaintext highlighter-rouge">this</code>-aware callback is passed is hard-bound with <code class="language-plaintext highlighter-rouge">bind(..)</code>. Don’t <code class="language-plaintext highlighter-rouge">bind(..)</code> a function reference if it’s not <code class="language-plaintext highlighter-rouge">this</code>-aware.</p>
  </li>
</ol>

<details>
    <summary>Work from this code
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">deepJS</span> <span class="o">=</span> <span class="nx">defineWorkshop</span><span class="p">();</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">311</span><span class="p">,</span><span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">,</span><span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">709</span><span class="p">,</span><span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">502</span><span class="p">,</span><span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">,</span><span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">,</span><span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">867</span><span class="p">,</span><span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollPaidStudents</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">remindUnpaidStudents</span><span class="p">();</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span>


<span class="c1">// ********************************</span>

<span class="kd">function</span> <span class="nx">defineWorkshop</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="kd">var</span> <span class="nx">studentRecords</span> <span class="o">=</span> <span class="p">[];</span>

	<span class="kd">var</span> <span class="nx">publicAPI</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">addStudent</span><span class="p">,</span>
		<span class="nx">enrollStudent</span><span class="p">,</span>
		<span class="nx">printCurrentEnrollment</span><span class="p">,</span>
		<span class="nx">enrollPaidStudents</span><span class="p">,</span>
		<span class="nx">remindUnpaidStudents</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="k">return</span> <span class="nx">publicAPI</span><span class="p">;</span>


	<span class="c1">// ********************************</span>

	<span class="kd">function</span> <span class="nx">addStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="nx">name</span><span class="p">,</span><span class="nx">paid</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">studentRecords</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">paid</span><span class="p">,</span> <span class="p">});</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">enrollStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
			<span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">printCurrentEnrollment</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">printRecords</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">enrollPaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
		<span class="nx">printCurrentEnrollment</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">remindUnpaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">matchId</span><span class="p">);</span>

		<span class="c1">// *************************</span>

		<span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentFromId</span><span class="p">);</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortByNameAsc</span><span class="p">);</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">printRecord</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span><span class="nx">record2</span><span class="p">){</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">recordsToEnroll</span> <span class="o">=</span> <span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">needToEnroll</span><span class="p">);</span>

		<span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">recordsToEnroll</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getStudentId</span><span class="p">);</span>

		<span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">needToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">notYetPaid</span><span class="p">);</span>

		<span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">notYetPaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>


</details>

<h3 id="this-exercise-solution">this Exercise Solution</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ********************************</span>

<span class="kd">var</span> <span class="nx">deepJS</span> <span class="o">=</span>  <span class="p">{</span>
	<span class="na">currentEnrollment</span><span class="p">:</span> <span class="p">[],</span>
	<span class="na">studentRecords</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nx">addStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="nx">name</span><span class="p">,</span><span class="nx">paid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">paid</span><span class="p">,</span> <span class="p">});</span>
	<span class="p">},</span>
	<span class="nx">enrollStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="nx">printCurrentEnrollment</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">printRecords</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">enrollPaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">();</span>
	<span class="p">},</span>
	<span class="nx">remindUnpaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">remindUnpaid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">matchId</span><span class="p">);</span>

		<span class="c1">// *************************</span>

		<span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStudentFromId</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sortByNameAsc</span><span class="p">);</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">printRecord</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span><span class="nx">record2</span><span class="p">){</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">},</span>
	<span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">recordsToEnroll</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">needToEnroll</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">recordsToEnroll</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStudentId</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
	<span class="p">},</span>
	<span class="nx">needToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
	<span class="p">},</span>
	<span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
	<span class="p">},</span>
	<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notYetPaid</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">notYetPaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">311</span><span class="p">,</span><span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">,</span><span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">709</span><span class="p">,</span><span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">502</span><span class="p">,</span><span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">,</span><span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">,</span><span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">867</span><span class="p">,</span><span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollPaidStudents</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">remindUnpaidStudents</span><span class="p">();</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span></code></pre></figure>


</details>

<p>Q: Would you [instructor] use this type of namespace object with so many functions in practice?</p>

<p>A: If I am going to create a namespace(d) object, the only reason I am going to use this approach (instead of the module approach) is when I know that I have two or three objects that I want to link through a prototype chain and have them work with each other.</p>

<p>Q: What is the rule for binding <code class="language-plaintext highlighter-rouge">this</code>?</p>

<p>A: You only need to bind <code class="language-plaintext highlighter-rouge">this</code> if the method is a this-aware function.</p>

<h3 id="es6-class-keyword">ES6 class Keyword</h3>

<p>The class pattern is by far the most prevalent used in JavaScript. The class system is syntactic sugar layered on top of the prototype system. The class pattern looks like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">class</span> <span class="nx">Workshop</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">teacher</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">teacher</span> <span class="o">=</span> <span class="nx">teacher</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">deepJS</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Workshop</span><span class="p">(</span><span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">reactJS</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Workshop</span><span class="p">(</span><span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">deepJs</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">Is 'class' a class?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle is 'class' a class?</span>

<span class="nx">reactJS</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">Is this class OK?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Suzy Is this class OK?</span></code></pre></figure>

<p>Classes don’t have to be statements, they can be expressions and they can be anonymous. Classes can be defined with or without an extends clause. In the above code a class is being defined, nothing is being extended. You can choose to define a <code class="language-plaintext highlighter-rouge">constructor</code> and you can add methods (no comma needed). If you want to extend a class, it could look something like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">class</span> <span class="nx">Workshop</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">teacher</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">teacher</span> <span class="o">=</span> <span class="nx">teacher</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">AnotherWorkshop</span> <span class="kd">extends</span> <span class="nx">Workshop</span> <span class="p">{</span>
    <span class="nx">speakUp</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">JSRecentParts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AnotherWorkshop</span><span class="p">(</span><span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">JSRecentParts</span><span class="p">.</span><span class="nx">speakUp</span><span class="p">(</span><span class="dl">"</span><span class="s2">Are classes getting any better?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle Are classes getting any better?</span></code></pre></figure>

<p>If you have a child class that extends the a method of the same name in its parent class, you can refer to the parent from the child by using <code class="language-plaintext highlighter-rouge">super.</code>; i.e. <code class="language-plaintext highlighter-rouge">super.ask...</code>. If you pay attention to the [JavaScript] spec, classes have a lot of features coming down the pipeline, almost making them a language inside of a language, not just syntactic sugar. Class methods are not auto-bound to the <code class="language-plaintext highlighter-rouge">this</code> keyword. The entire class system is built on the idea that your methods do not exist on their instances, but on your prototypes.</p>

<h3 id="fixing-this-in-classes">Fixing this in Classes</h3>

<p>There is a proposal for <code class="language-plaintext highlighter-rouge">@bound</code> which would auto-bind <code class="language-plaintext highlighter-rouge">this</code> in classes, but here’s why that is considered to be aa <em>bad</em> idea. Any ‘solution’ to ‘auto-bind’ <code class="language-plaintext highlighter-rouge">this</code> to a class is not what the intended behavior of classes in JavaScript is. <a href="https://gist.github.com/getify/86bed0bb78ccb517c84a6e61ec16adca">Check out this gist to see how it could be done - see 2.js</a> The whole purpose of <code class="language-plaintext highlighter-rouge">this</code> aware functions is so that they can be dynamic. Forcing them into another mode of working, which is like classes in other languages, is how you end up with ‘hacky’ solutions like the Gist.</p>

<h3 id="class-exercise">class Exercise</h3>

<h4 id="class"><code class="language-plaintext highlighter-rouge">class</code></h4>

<p>In this exercise, you will refactor some code that manages student enrollment records for a workshop, from the namespace pattern to the <code class="language-plaintext highlighter-rouge">class</code> pattern.</p>

<h4 id="instructions-4">Instructions</h4>

<ol>
  <li>
    <p>Define a class called <code class="language-plaintext highlighter-rouge">Helpers</code> that includes the functions that are not <code class="language-plaintext highlighter-rouge">this</code>-aware.</p>
  </li>
  <li>
    <p>Define a class called <code class="language-plaintext highlighter-rouge">Workshop</code> that extends <code class="language-plaintext highlighter-rouge">Helpers</code>, which includes all the other functions. Hint: <code class="language-plaintext highlighter-rouge">constructor()</code> and <code class="language-plaintext highlighter-rouge">super()</code>.</p>
  </li>
  <li>
    <p>Instantiate the <code class="language-plaintext highlighter-rouge">Workshop</code> class as <code class="language-plaintext highlighter-rouge">deepJS</code>.</p>
  </li>
</ol>

<details>
    <summary>Work from this code
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">deepJS</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">currentEnrollment</span><span class="p">:</span> <span class="p">[],</span>
	<span class="na">studentRecords</span><span class="p">:</span> <span class="p">[],</span>
	<span class="nx">addStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="nx">name</span><span class="p">,</span><span class="nx">paid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">paid</span><span class="p">,</span> <span class="p">});</span>
	<span class="p">},</span>
	<span class="nx">enrollStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="nx">printCurrentEnrollment</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">printRecords</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">enrollPaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">();</span>
	<span class="p">},</span>
	<span class="nx">remindUnpaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">remindUnpaid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">matchId</span><span class="p">);</span>

		<span class="c1">// *************************</span>

		<span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStudentFromId</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sortByNameAsc</span><span class="p">);</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">printRecord</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span><span class="nx">record2</span><span class="p">){</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">},</span>
	<span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">recordsToEnroll</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">needToEnroll</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">recordsToEnroll</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStudentId</span><span class="p">);</span>

		<span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
	<span class="p">},</span>
	<span class="nx">needToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
	<span class="p">},</span>
	<span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
	<span class="p">},</span>
	<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notYetPaid</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="nx">notYetPaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>


<span class="c1">// ********************************</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">311</span><span class="p">,</span><span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">,</span><span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">709</span><span class="p">,</span><span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">502</span><span class="p">,</span><span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">,</span><span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">,</span><span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">867</span><span class="p">,</span><span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollPaidStudents</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">remindUnpaidStudents</span><span class="p">();</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span></code></pre></figure>


</details>

<h3 id="class-exercise-solution">class Exercise Solution</h3>

<details>
    <summary>Click to view the solution
</summary>
    
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">class</span> <span class="nx">Helpers</span> <span class="p">{</span>

    <span class="nx">sortByNameAsc</span><span class="p">(</span><span class="nx">record1</span><span class="p">,</span><span class="nx">record2</span><span class="p">){</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">record1</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">record2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">printRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">): </span><span class="p">${</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Paid</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Not Paid</span><span class="dl">"</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">Workshop</span> <span class="kd">extends</span> <span class="nx">Helpers</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
    <span class="nx">addStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="nx">name</span><span class="p">,</span><span class="nx">paid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">paid</span><span class="p">,</span> <span class="p">});</span>
	<span class="p">}</span>
	<span class="nx">enrollStudent</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="nx">printCurrentEnrollment</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">printRecords</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">enrollPaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paidStudentsToEnroll</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="nx">remindUnpaidStudents</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">remindUnpaid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">matchId</span><span class="p">);</span>

		<span class="c1">// *************************</span>

		<span class="kd">function</span> <span class="nx">matchId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">studentId</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="nx">printRecords</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStudentFromId</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sortByNameAsc</span><span class="p">);</span>

		<span class="nx">records</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">printRecord</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="nx">paidStudentsToEnroll</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">recordsToEnroll</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">needToEnroll</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="kd">var</span> <span class="nx">idsToEnroll</span> <span class="o">=</span> <span class="nx">recordsToEnroll</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStudentId</span><span class="p">);</span>

		<span class="k">return</span> <span class="p">[</span> <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">,</span> <span class="p">...</span><span class="nx">idsToEnroll</span> <span class="p">];</span>
	<span class="p">}</span>
	<span class="nx">needToEnroll</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">currentEnrollment</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="nx">getStudentId</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nx">remindUnpaid</span><span class="p">(</span><span class="nx">recordIds</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">unpaidIds</span> <span class="o">=</span> <span class="nx">recordIds</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notYetPaid</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">printRecords</span><span class="p">(</span><span class="nx">unpaidIds</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">notYetPaid</span><span class="p">(</span><span class="nx">studentId</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStudentFromId</span><span class="p">(</span><span class="nx">studentId</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">paid</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">deepJS</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Workshop</span><span class="p">();</span>

<span class="c1">// ********************************</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">311</span><span class="p">,</span><span class="dl">"</span><span class="s2">Frank</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">,</span><span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">709</span><span class="p">,</span><span class="dl">"</span><span class="s2">Brian</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="dl">"</span><span class="s2">Henry</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">502</span><span class="p">,</span><span class="dl">"</span><span class="s2">Mary</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">,</span><span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="dl">"</span><span class="s2">Peter</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">,</span><span class="dl">"</span><span class="s2">Sarah</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">addStudent</span><span class="p">(</span><span class="mi">867</span><span class="p">,</span><span class="dl">"</span><span class="s2">Greg</span><span class="dl">"</span><span class="p">,</span><span class="cm">/*paid=*/</span><span class="kc">false</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">410</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">105</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">664</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollStudent</span><span class="p">(</span><span class="mi">375</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">printCurrentEnrollment</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">enrollPaidStudents</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">----</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">deepJS</span><span class="p">.</span><span class="nx">remindUnpaidStudents</span><span class="p">();</span>

<span class="cm">/*
	Bob (664): Not Paid
	Henry (105): Not Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Frank (313): Paid
	Henry (105): Not Paid
	Mary (502): Paid
	Peter (250): Paid
	Sarah (375): Paid
	Suzy (410): Paid
	----
	Bob (664): Not Paid
	Henry (105): Not Paid
*/</span></code></pre></figure>


</details>

<h2 id="prototypes">Prototypes</h2>

<h3 id="prototypes-1">Prototypes</h3>

<p>Now that we have learned what the syntactic sugar layer looks like, lets look under the hood and find out how the prototype system that classes are layered on top of actually works. First observation: Objects that exist in our programs that we can see, have created, or that we interact with are always created by ‘constructor calls’ (via <code class="language-plaintext highlighter-rouge">new</code>). When you use <code class="language-plaintext highlighter-rouge">new</code> in front of a function call, JavaScript is constructing an object to be used for <code class="language-plaintext highlighter-rouge">this</code> binding of that function call. The following statement is not <em>entirely</em> correct:</p>

<p><em>A constructor call makes an object based-on its own prototype</em></p>

<p>Let’s learn more about classes from a Computer Science[CS] perspective to understand why ‘based-on’ in the above statement is incorrect. The most common way in CS to describe the difference between a class and an instance is that a class is the abstract pattern for a thing, like a blueprint. The instance is similar to when an architect takes the blueprint and builds the thing. Class-oriented development is fundamentally a copy operation. Continuing on the blueprint / thing being built analogy, what would happen if after you’ve completed the blueprint and built the thing, you went back to the blueprint and added something, would it then be reflected in the thing that was built? Or how about the other way around? If you added something to the thing, would it be reflected in the blueprint? The answer to both is <strong>no</strong>. The moment the thing is instantiated from the blueprint, the relationship between the two ceases to exist. The instantiation creates a ‘copy’ and everything is inherited.</p>

<p>Speaking of inheritance, a parent / child relationship between classes is also fundamentally a copy operation as previously described. One small caveat to the idea of creating a copy… JavaScript doesn’t do any copying… To properly describe what is happening when a constructor call makes an object, it doesn’t make it ‘based-on’ the prototype, it makes it <strong>linked to</strong> the prototype. Some would argue that copy vs link is just two sides of the same coin, but copying and linking are fundamentally opposite to one another. The difference between them can completely change based on whether your mental model is all about copying vs linking. The difference matters because when your program breaks, why did it break? It broke because you had a divergence from what you thought your program was doing, your mental model, and what the system was actually doing. If you are thinking copying and it is doing linking, what do you think is going to happen? BUGS!</p>

<h3 id="prototypal-class">Prototypal Class</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">Workshop</span><span class="p">(</span><span class="nx">teacher</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">teacher</span> <span class="o">=</span> <span class="nx">teacher</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Workshop</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ask</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">teacher</span><span class="p">,</span> <span class="nx">question</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">deepJS</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Workshop</span><span class="p">(</span><span class="dl">"</span><span class="s2">Kyle</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">reactJS</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Workshop</span><span class="p">(</span><span class="dl">"</span><span class="s2">Suzy</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">deepJS</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">Is 'prototype' a class?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Kyle Is 'prototype' a class?</span>

<span class="nx">reactJS</span><span class="p">.</span><span class="nx">ask</span><span class="p">(</span><span class="dl">"</span><span class="s2">Isn't 'prototype' ugly?</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Suzy Isn't 'prototype' ugly?</span></code></pre></figure>

<p>Underneath the syntactic sugar of <code class="language-plaintext highlighter-rouge">class</code> is the <code class="language-plaintext highlighter-rouge">prototype</code>, which looks quite similar. This is useful for our understanding of how classes work.</p>

<h3 id="the-prototype-chain">The Prototype Chain</h3>

<h3 id="dunder-prototypes">Dunder Prototypes</h3>

<h3 id="this--prototypes-qa">this &amp; prototypes Q&amp;A</h3>

<h3 id="shadowing-prototypes">Shadowing Prototypes</h3>

<h3 id="prototypal-inheritance">Prototypal Inheritance</h3>

<h3 id="classical-vs-prototypal-inheritance">Classical vs Prototypal Inheritance</h3>

<h3 id="inheritance-is-delegation">Inheritance is Delegation</h3>

<h3 id="oloo-pattern">OLOO Pattern</h3>

<h3 id="delegation-oriented-design">Delegation-Oriented Design</h3>

<h2 id="wrapping-up">Wrapping Up</h2>

<h3 id="wrapping-up-1">Wrapping Up</h3>

<h3 id="bonus-typl">Bonus: Typl</h3>

</div>
    </main>

    
    
    


  
<footer class="usa-footer usa-footer-medium" role="contentinfo">

  

  
    <div class="usa-grid usa-footer-return-to-top">
      <a href="#">Return to top</a>
    </div>
  



  

  
  <div class="usa-footer-secondary_section">
    <div class="usa-grid">
      <div class="usa-footer-logo">
        
          
            <img class="usa-footer-logo-img" src="/assets/img/hztl-wm.svg" alt="HZTL-WM">
            
          
        

        
        <p>William has consumed <span class="la-croix"></span> cans of <a href="/la-croix"><span class="la-croix-logo"></span></a> since Sept. 3rd, 2019.<br/><em class="lighten-up"> * cans of delicious, bubbly, essenced water consumed accurate by ±50%</em></p>
        
        
      </div>

      
      <div class="usa-footer-contact-links usa-width-one-half">
        
        
        
          
      
      
      </div>
    </div>
  </div>
  

</footer>




    
    





  
<script src="/assets/uswds/js/uswds.min.js" async></script>





    <script src="/assets/js/la-croix.js"></script>
    
    <script src="/assets/js/scroll-watch.js"></script>
    

  </body>
</html>
